!function(){"use strict";var n,t,e,r,o,i,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(n){return function(){return n}},c=a(!1),l=a(!0),y={noop:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t]},noarg:function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e()}},compose:function(e,r){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return e(r.apply(null,arguments))}},constant:a,identity:function(n){return n},tripleEquals:function(n,t){return n===t},curry:function(i){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var u=new Array(arguments.length-1),e=1;e<arguments.length;e++)u[e-1]=arguments[e];return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var o=u.concat(e);return i.apply(null,o)}},not:function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return!e.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:c,always:l},s=y.never,f=y.always,d=function(){return m},m=(r={fold:function(n,t){return n()},is:s,isSome:s,isNone:f,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:e,orThunk:t,map:d,ap:d,each:function(){},bind:d,flatten:d,exists:s,forall:f,filter:d,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:y.constant("none()")},Object.freeze&&Object.freeze(r),r),g=function(e){var n=function(){return e},t=function(){return o},r=function(n){return n(e)},o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:f,isNone:s,getOr:n,getOrThunk:n,getOrDie:n,or:t,orThunk:t,map:function(n){return g(n(e))},ap:function(n){return n.fold(d,function(n){return g(n(e))})},each:function(n){n(e)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(e)?o:m},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(s,function(n){return t(e,n)})},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o},x={some:g,none:d,from:function(n){return null==n?m:g(n)}},h=function(t){return function(n){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(n)===t}},p={isString:h("string"),isObject:h("object"),isArray:h("array"),isNull:h("null"),isBoolean:h("boolean"),isUndefined:h("undefined"),isFunction:h("function"),isNumber:h("number")},v=void 0===(o=Array.prototype.indexOf)?function(n,t){return D(n,t)}:function(n,t){return o.call(n,t)},b=function(n,t){return-1<v(n,t)},w=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o,n)}return r},C=function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e,n)},S=function(n,t){for(var e=n.length-1;0<=e;e--)t(n[e],e,n)},R=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var i=n[r];t(i,r,n)&&e.push(i)}return e},T=function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e,n))return x.some(e);return x.none()},D=function(n,t){for(var e=0,r=n.length;e<r;++e)if(n[e]===t)return e;return-1},A=Array.prototype.push,k=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!Array.prototype.isPrototypeOf(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);A.apply(t,n[e])}return t},O=function(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e,n))return!1;return!0},N=Array.prototype.slice,E=p.isFunction(Array.from)?Array.from:function(n){return N.call(n)},B={map:w,each:C,eachr:S,partition:function(n,t){for(var e=[],r=[],o=0,i=n.length;o<i;o++){var u=n[o];(t(u,o,n)?e:r).push(u)}return{pass:e,fail:r}},filter:R,groupBy:function(n,t){if(0===n.length)return[];for(var e=t(n[0]),r=[],o=[],i=0,u=n.length;i<u;i++){var a=n[i],c=t(a);c!==e&&(r.push(o),o=[]),e=c,o.push(a)}return 0!==o.length&&r.push(o),r},indexOf:function(n,t){var e=v(n,t);return-1===e?x.none():x.some(e)},foldr:function(n,t,e){return S(n,function(n){e=t(e,n)}),e},foldl:function(n,t,e){return C(n,function(n){e=t(e,n)}),e},find:function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e,n))return x.some(o)}return x.none()},findIndex:T,flatten:k,bind:function(n,t){var e=w(n,t);return k(e)},forall:O,exists:function(n,t){return T(n,t).isSome()},contains:b,equal:function(n,e){return n.length===e.length&&O(n,function(n,t){return n===e[t]})},reverse:function(n){var t=N.call(n,0);return t.reverse(),t},chunk:function(n,t){for(var e=[],r=0;r<n.length;r+=t){var o=n.slice(r,r+t);e.push(o)}return e},difference:function(n,t){return R(n,function(n){return!b(t,n)})},mapToObject:function(n,t){for(var e={},r=0,o=n.length;r<o;r++){var i=n[r];e[String(i)]=t(i,r)}return e},pure:function(n){return[n]},sort:function(n,t){var e=N.call(n,0);return e.sort(t),e},range:function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},head:function(n){return 0===n.length?x.none():x.some(n[0])},last:function(n){return 0===n.length?x.none():x.some(n[n.length-1])},from:E},P=void 0===(i=Object.keys)?function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}:i,I=function(n,t){for(var e=P(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i,n)}},W=function(r,o){var i={};return I(r,function(n,t){var e=o(n,t,r);i[e.k]=e.v}),i},M=function(n,e){var r=[];return I(n,function(n,t){r.push(e(n,t))}),r},L=function(n){return M(n,function(n){return n})},q={bifilter:function(n,e){var r={},o={};return I(n,function(n,t){(e(n,t)?r:o)[t]=n}),{t:r,f:o}},each:I,map:function(n,r){return W(n,function(n,t,e){return{k:t,v:r(n,t,e)}})},mapToArray:M,tupleMap:W,find:function(n,t){for(var e=P(n),r=0,o=e.length;r<o;r++){var i=e[r],u=n[i];if(t(u,i,n))return x.some(u)}return x.none()},keys:P,values:L,size:function(n){return L(n).length}},j=function(n){return n.slice(0).sort()},_=function(n,t){throw new Error("All required keys ("+j(n).join(", ")+") were not specified. Specified keys were: "+j(t).join(", ")+".")},z=function(n){throw new Error("Unsupported keys for object: "+j(n).join(", "))},F=function(t,n){if(!p.isArray(n))throw new Error("The "+t+" fields must be an array. Was: "+n+".");B.each(n,function(n){if(!p.isString(n))throw new Error("The value "+n+" in the "+t+" fields was not a string.")})},H=function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+j(n).join(", ")+") were not.")},U=function(n){var e=j(n);B.find(e,function(n,t){return t<e.length-1&&n===e[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})},V={immutable:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+e.length+" arguments");var r={};return B.each(t,function(n,t){r[n]=y.constant(e[t])}),r}},immutableBag:function(o,i){var u=o.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return F("required",o),F("optional",i),U(u),function(t){var e=q.keys(t);B.forall(o,function(n){return B.contains(e,n)})||_(o,e);var n=B.filter(e,function(n){return!B.contains(u,n)});0<n.length&&z(n);var r={};return B.each(o,function(n){r[n]=y.constant(t[n])}),B.each(i,function(n){r[n]=y.constant(Object.prototype.hasOwnProperty.call(t,n)?x.some(t[n]):x.none())}),r}}},G=V.immutable("width","height"),X=V.immutable("rows","columns"),Y=V.immutable("row","column"),K=V.immutable("x","y"),$=V.immutable("element","rowspan","colspan"),J=V.immutable("element","rowspan","colspan","isNew"),Q={dimensions:G,grid:X,address:Y,coords:K,extended:V.immutable("element","rowspan","colspan","row","column"),detail:$,detailnew:J,rowdata:V.immutable("element","cells","section"),elementnew:V.immutable("element","isNew"),rowdatanew:V.immutable("element","cells","section","isNew"),rowcells:V.immutable("cells","section"),rowdetails:V.immutable("details","section"),bounds:V.immutable("startRow","startCol","finishRow","finishCol")},Z=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:y.constant(n)}},nn={fromHtml:function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return Z(e.childNodes[0])},fromTag:function(n,t){var e=(t||document).createElement(n);return Z(e)},fromText:function(n,t){var e=(t||document).createTextNode(n);return Z(e)},fromDom:Z,fromPoint:function(n,t,e){return x.from(n.dom().elementFromPoint(t,e)).map(Z)}},tn=8,en=9,rn=1,on=3,un=rn,an=en,cn=function(n){return n.nodeType!==un&&n.nodeType!==an||0===n.childElementCount},ln={all:function(n,t){var e=void 0===t?document:t.dom();return cn(e)?[]:B.map(e.querySelectorAll(n),nn.fromDom)},is:function(n,t){var e=n.dom();if(e.nodeType!==un)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},one:function(n,t){var e=void 0===t?document:t.dom();return cn(e)?x.none():x.from(e.querySelector(n)).map(nn.fromDom)}},sn=function(n,t){for(var e=[],r=function(n){return e.push(n),t(n)},o=t(n);(o=o.bind(r)).isSome(););return e},fn="undefined"!=typeof window?window:Function("return this;")(),dn=function(n,t){for(var e=null!=t?t:fn,r=0;r<n.length&&null!=e;++r)e=e[n[r]];return e},mn=function(n,t){var e=n.split(".");return dn(e,t)},gn=function(n,t){var e=mn(n,t);if(null==e)throw n+" not available on this browser";return e},hn=function(){return gn("Node")},pn=function(n,t,e){return 0!=(n.compareDocumentPosition(t)&e)},vn=function(n,t){return pn(n,t,hn().DOCUMENT_POSITION_CONTAINED_BY)},bn=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(null,arguments)),t}},wn=function(){return yn(0,0)},yn=function(n,t){return{major:n,minor:t}},xn={nu:yn,detect:function(n,t){var e=String(t).toLowerCase();return 0===n.length?wn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return yn(r(1),r(2))}(n,e)},unknown:wn},Cn="Firefox",Sn=function(n,t){return function(){return t===n}},Rn=function(n){var t=n.current;return{current:t,version:n.version,isEdge:Sn("Edge",t),isChrome:Sn("Chrome",t),isIE:Sn("IE",t),isOpera:Sn("Opera",t),isFirefox:Sn(Cn,t),isSafari:Sn("Safari",t)}},Tn={unknown:function(){return Rn({current:void 0,version:xn.unknown()})},nu:Rn,edge:y.constant("Edge"),chrome:y.constant("Chrome"),ie:y.constant("IE"),opera:y.constant("Opera"),firefox:y.constant(Cn),safari:y.constant("Safari")},Dn="Windows",An="Android",kn="Solaris",On="FreeBSD",Nn=function(n,t){return function(){return t===n}},En=function(n){var t=n.current;return{current:t,version:n.version,isWindows:Nn(Dn,t),isiOS:Nn("iOS",t),isAndroid:Nn(An,t),isOSX:Nn("OSX",t),isLinux:Nn("Linux",t),isSolaris:Nn(kn,t),isFreeBSD:Nn(On,t)}},Bn={unknown:function(){return En({current:void 0,version:xn.unknown()})},nu:En,windows:y.constant(Dn),ios:y.constant("iOS"),android:y.constant(An),linux:y.constant("Linux"),osx:y.constant("OSX"),solaris:y.constant(kn),freebsd:y.constant(On)},Pn=function(n,t){var e=String(t).toLowerCase();return B.find(n,function(n){return n.search(e)})},In=function(n,e){return Pn(n,e).map(function(n){var t=xn.detect(n.versionRegexes,e);return{current:n.name,version:t}})},Wn=function(n,e){return Pn(n,e).map(function(n){var t=xn.detect(n.versionRegexes,e);return{current:n.name,version:t}})},Mn=function(n,t){return t+n},Ln=function(n,t){return n+t},qn=function(n,t){return n.substring(t)},jn=function(n,t){return n.substring(0,n.length-t)},_n=function(n){return""===n?x.none():x.some(n.substr(0,1))},zn=function(n){return""===n?x.none():x.some(n.substring(1))},Fn=function(n,t,e){return""===t||!(n.length<t.length)&&n.substr(e,e+t.length)===t},Hn=function(n,t){return Fn(n,t,0)},Un=function(n,t){return Fn(n,t,n.length-t.length)},Vn={supplant:function(n,o){return n.replace(/\${([^{}]*)}/g,function(n,t){var e,r=o[t];return"string"==(e=typeof r)||"number"===e?r:n})},startsWith:Hn,removeLeading:function(n,t){return Hn(n,t)?qn(n,t.length):n},removeTrailing:function(n,t){return Un(n,t)?jn(n,t.length):n},ensureLeading:function(n,t){return Hn(n,t)?n:Mn(n,t)},ensureTrailing:function(n,t){return Un(n,t)?n:Ln(n,t)},endsWith:Un,contains:function(n,t){return-1!==n.indexOf(t)},trim:function(n){return n.replace(/^\s+|\s+$/g,"")},lTrim:function(n){return n.replace(/^\s+/g,"")},rTrim:function(n){return n.replace(/\s+$/g,"")},capitalize:function(n){return _n(n).bind(function(t){return zn(n).map(function(n){return t.toUpperCase()+n})}).getOr(n)}},Gn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Xn=function(t){return function(n){return Vn.contains(n,t)}},Yn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Vn.contains(n,"edge/")&&Vn.contains(n,"chrome")&&Vn.contains(n,"safari")&&Vn.contains(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Gn],search:function(n){return Vn.contains(n,"chrome")&&!Vn.contains(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Vn.contains(n,"msie")||Vn.contains(n,"trident")}},{name:"Opera",versionRegexes:[Gn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Xn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Xn("firefox")},{name:"Safari",versionRegexes:[Gn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Vn.contains(n,"safari")||Vn.contains(n,"mobile/"))&&Vn.contains(n,"applewebkit")}}],Kn=[{name:"Windows",search:Xn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Vn.contains(n,"iphone")||Vn.contains(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Xn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Xn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Xn("linux"),versionRegexes:[]},{name:"Solaris",search:Xn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Xn("freebsd"),versionRegexes:[]}],$n={browsers:y.constant(Yn),oses:y.constant(Kn)},Jn=function(n){var t,e,r,o,i,u,a,c,l,s,f,d=$n.browsers(),m=$n.oses(),g=In(d,n).fold(Tn.unknown,Tn.nu),h=Wn(m,n).fold(Bn.unknown,Bn.nu);return{browser:g,os:h,deviceType:(e=g,r=n,o=(t=h).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,u=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,c=o||u||a&&!0===/mobile/i.test(r),l=t.isiOS()||t.isAndroid(),s=l&&!c,f=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:y.constant(o),isiPhone:y.constant(i),isTablet:y.constant(c),isPhone:y.constant(s),isTouch:y.constant(l),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:y.constant(f)})}},Qn={detect:bn(function(){var n=navigator.userAgent;return Jn(n)})},Zn=function(n,t){return n.dom()===t.dom()},nt=Qn.detect().browser.isIE()?function(n,t){return vn(n.dom(),t.dom())}:function(n,t){var e=n.dom(),r=t.dom();return e!==r&&e.contains(r)},tt={eq:Zn,isEqualNode:function(n,t){return n.dom().isEqualNode(t.dom())},member:function(n,t){return B.exists(t,y.curry(Zn,n))},contains:nt,is:ln.is},et=function(n){return nn.fromDom(n.dom().ownerDocument)},rt=function(n){var t=n.dom();return x.from(t.parentNode).map(nn.fromDom)},ot=function(n){var t=n.dom();return x.from(t.previousSibling).map(nn.fromDom)},it=function(n){var t=n.dom();return x.from(t.nextSibling).map(nn.fromDom)},ut=function(n){var t=n.dom();return B.map(t.childNodes,nn.fromDom)},at=function(n,t){var e=n.dom().childNodes;return x.from(e[t]).map(nn.fromDom)},ct=V.immutable("element","offset"),lt={owner:et,defaultView:function(n){var t=n.dom().ownerDocument.defaultView;return nn.fromDom(t)},documentElement:function(n){var t=et(n);return nn.fromDom(t.dom().documentElement)},parent:rt,findIndex:function(e){return rt(e).bind(function(n){var t=ut(n);return B.findIndex(t,function(n){return tt.eq(e,n)})})},parents:function(n,t){for(var e=p.isFunction(t)?t:y.constant(!1),r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=nn.fromDom(i);if(o.push(u),!0===e(u))break;r=i}return o},siblings:function(t){return rt(t).map(ut).map(function(n){return B.filter(n,function(n){return!tt.eq(t,n)})}).getOr([])},prevSibling:ot,offsetParent:function(n){var t=n.dom();return x.from(t.offsetParent).map(nn.fromDom)},prevSiblings:function(n){return B.reverse(sn(n,ot))},nextSibling:it,nextSiblings:function(n){return sn(n,it)},children:ut,child:at,firstChild:function(n){return at(n,0)},lastChild:function(n){return at(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,t){var e=ut(n);return 0<e.length&&t<e.length?ct(e[t],0):ct(n,t)}},st=function(n,t,e){return B.bind(lt.children(n),function(n){return ln.is(n,t)?e(n)?[n]:[]:st(n,t,e)})},ft={firstLayer:function(n,t){return st(n,t,y.constant(!0))},filterFirstLayer:st},dt=function(n){return n.dom().nodeName.toLowerCase()},mt=function(n){return n.dom().nodeType},gt=function(t){return function(n){return mt(n)===t}},ht=gt(rn),pt=gt(on),vt=gt(en),bt={name:dt,type:mt,value:function(n){return n.dom().nodeValue},isElement:ht,isText:pt,isDocument:vt,isComment:function(n){return mt(n)===tn||"#comment"===dt(n)}},wt=function(n,t,e){if(!(p.isString(e)||p.isBoolean(e)||p.isNumber(e)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")},yt=function(n,t,e){wt(n.dom(),t,e)},xt=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},Ct=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},St={clone:function(n){return B.foldl(n.dom().attributes,function(n,t){return n[t.name]=t.value,n},{})},set:yt,setAll:function(n,t){var e=n.dom();q.each(t,function(n,t){wt(e,t,n)})},get:xt,has:Ct,remove:function(n,t){n.dom().removeAttribute(t)},hasNone:function(n){var t=n.dom().attributes;return null==t||0===t.length},transfer:function(o,i,n){bt.isElement(o)&&bt.isElement(i)&&B.each(n,function(n){var t,e,r;e=i,Ct(t=o,r=n)&&!Ct(e,r)&&yt(e,r,xt(t,r))})}},Rt=bn(function(){return Tt(nn.fromDom(document))}),Tt=function(n){var t=n.dom().body;if(null==t)throw"Body is not available yet";return nn.fromDom(t)},Dt={body:Rt,getBody:Tt,inBody:function(n){var t=bt.isText(n)?n.dom().parentNode:n.dom();return null!=t&&t.ownerDocument.body.contains(t)}},At=function(n,t){var e=[];return B.each(lt.children(n),function(n){t(n)&&(e=e.concat([n])),e=e.concat(At(n,t))}),e},kt={all:function(n){return At(Dt.body(),n)},ancestors:function(n,t,e){return B.filter(lt.parents(n,e),t)},siblings:function(n,t){return B.filter(lt.siblings(n),t)},children:function(n,t){return B.filter(lt.children(n),t)},descendants:At},Ot={all:function(n){return ln.all(n)},ancestors:function(n,t,e){return kt.ancestors(n,function(n){return ln.is(n,t)},e)},siblings:function(n,t){return kt.siblings(n,function(n){return ln.is(n,t)})},children:function(n,t){return kt.children(n,function(n){return ln.is(n,t)})},descendants:function(n,t){return ln.all(t,n)}};function Nt(n,t,e,r,o){return n(e,r)?x.some(e):p.isFunction(o)&&o(e)?x.none():t(e,r,o)}var Et,Bt,Pt,It,Wt,Mt=function(n,t,e){for(var r=n.dom(),o=p.isFunction(e)?e:y.constant(!1);r.parentNode;){r=r.parentNode;var i=nn.fromDom(r);if(t(i))return x.some(i);if(o(i))break}return x.none()},Lt=function(n,t){return B.find(n.dom().childNodes,y.compose(t,nn.fromDom)).map(nn.fromDom)},qt=function(n,r){var o=function(n){for(var t=0;t<n.childNodes.length;t++){if(r(nn.fromDom(n.childNodes[t])))return x.some(nn.fromDom(n.childNodes[t]));var e=o(n.childNodes[t]);if(e.isSome())return e}return x.none()};return o(n.dom())},jt={first:function(n){return qt(Dt.body(),n)},ancestor:Mt,closest:function(n,t,e){return Nt(function(n){return t(n)},Mt,n,t,e)},sibling:function(t,e){var n=t.dom();return n.parentNode?Lt(nn.fromDom(n.parentNode),function(n){return!tt.eq(t,n)&&e(n)}):x.none()},child:Lt,descendant:qt},_t=function(n,t,e){return jt.ancestor(n,function(n){return ln.is(n,t)},e)},zt={first:function(n){return ln.one(n)},ancestor:_t,sibling:function(n,t){return jt.sibling(n,function(n){return ln.is(n,t)})},child:function(n,t){return jt.child(n,function(n){return ln.is(n,t)})},descendant:function(n,t){return ln.one(t,n)},closest:function(n,t,e){return Nt(ln.is,_t,n,t,e)}},Ft=function(n,t,e){var r=void 0!==e?e:y.constant(!1);return r(t)?x.none():B.contains(n,bt.name(t))?x.some(t):zt.ancestor(t,n.join(","),function(n){return ln.is(n,"table")||r(n)})},Ht=function(t,n){return lt.parent(n).map(function(n){return Ot.children(n,t)})},Ut=y.curry(Ht,"th,td"),Vt=y.curry(Ht,"tr"),Gt=function(n,t){return parseInt(St.get(n,t),10)},Xt={cell:function(n,t){return Ft(["td","th"],n,t)},firstCell:function(n){return zt.descendant(n,"th,td")},cells:function(n){return ft.firstLayer(n,"th,td")},neighbourCells:Ut,table:function(n,t){return zt.closest(n,"table",t)},row:function(n,t){return Ft(["tr"],n,t)},rows:function(n){return ft.firstLayer(n,"tr")},notCell:function(n,t){return Ft(["caption","tr","tbody","tfoot","thead"],n,t)},neighbourRows:Vt,attr:Gt,grid:function(n,t,e){var r=Gt(n,t),o=Gt(n,e);return Q.grid(r,o)}},Yt=function(n){var t=Xt.rows(n);return B.map(t,function(n){var t=n,e=lt.parent(t).bind(function(n){var t=bt.name(n);return"tfoot"===t||"thead"===t||"tbody"===t?t:"tbody"}),r=B.map(Xt.cells(n),function(n){var t=St.has(n,"rowspan")?parseInt(St.get(n,"rowspan"),10):1,e=St.has(n,"colspan")?parseInt(St.get(n,"colspan"),10):1;return Q.detail(n,t,e)});return Q.rowdata(t,r,e)})},Kt=function(n,e){return B.map(n,function(n){var t=B.map(Xt.cells(n),function(n){var t=St.has(n,"rowspan")?parseInt(St.get(n,"rowspan"),10):1,e=St.has(n,"colspan")?parseInt(St.get(n,"colspan"),10):1;return Q.detail(n,t,e)});return Q.rowdata(n,t,e.section())})},$t=function(n,t){return n+","+t},Jt=function(n,t){var e=B.bind(n.all(),function(n){return n.cells()});return B.filter(e,t)},Qt={generate:function(n){var s={},t=[],e=n.length,f=0;B.each(n,function(n,c){var l=[];B.each(n.cells(),function(n,t){for(var e=0;void 0!==s[$t(c,e)];)e++;for(var r=Q.extended(n.element(),n.rowspan(),n.colspan(),c,e),o=0;o<n.colspan();o++)for(var i=0;i<n.rowspan();i++){var u=e+o,a=$t(c+i,u);s[a]=r,f=Math.max(f,u+1)}l.push(r)}),t.push(Q.rowdata(n.element(),l,n.section()))});var r=Q.grid(e,f);return{grid:y.constant(r),access:y.constant(s),all:y.constant(t)}},getAt:function(n,t,e){var r=n.access()[$t(t,e)];return void 0!==r?x.some(r):x.none()},findItem:function(n,t,e){var r=Jt(n,function(n){return e(t,n.element())});return 0<r.length?x.some(r[0]):x.none()},filterItems:Jt,justCells:function(n){var t=B.map(n.all(),function(n){return n.cells()});return B.flatten(t)}},Zt=function(n){return void 0!==n.style},ne=function(n,t,e){if(!p.isString(e))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",e,":: Element ",n),new Error("CSS value must be a string: "+e);Zt(n)&&n.style.setProperty(t,e)},te=function(n,t){Zt(n)&&n.style.removeProperty(t)},ee=function(n,t,e){var r=n.dom();ne(r,t,e)},re=function(n,t){return Zt(n)?n.style.getPropertyValue(t):""},oe=function(n,t){var e=n.dom(),r=re(e,t);return x.from(r).filter(function(n){return 0<n.length})},ie={copy:function(n,t){var e=n.dom(),r=t.dom();Zt(e)&&Zt(r)&&(r.style.cssText=e.style.cssText)},set:ee,preserve:function(n,t){var e=St.get(n,"style"),r=t(n);return(void 0===e?St.remove:St.set)(n,"style",e),r},setAll:function(n,t){var e=n.dom();q.each(t,function(n,t){ne(e,t,n)})},setOptions:function(n,t){var e=n.dom();q.each(t,function(n,t){n.fold(function(){te(e,t)},function(n){ne(e,t,n)})})},remove:function(n,t){var e=n.dom();te(e,t),St.has(n,"style")&&""===Vn.trim(St.get(n,"style"))&&St.remove(n,"style")},get:function(n,t){var e=n.dom(),r=window.getComputedStyle(e).getPropertyValue(t),o=""!==r||Dt.inBody(n)?r:re(e,t);return null===o?void 0:o},getRaw:oe,getAllRaw:function(n){var t={},e=n.dom();if(Zt(e))for(var r=0;r<e.style.length;r++){var o=e.style.item(r);t[o]=e.style[o]}return t},isValidValue:function(n,t,e){var r=nn.fromTag(n);return ee(r,t,e),oe(r,t).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(r,o,n){bt.isElement(r)&&bt.isElement(o)&&B.each(n,function(n){var t,e;t=o,oe(r,e=n).each(function(n){oe(t,e).isNone()&&ee(t,e,n)})})}},ue=function(t,e){lt.parent(t).each(function(n){n.dom().insertBefore(e.dom(),t.dom())})},ae=function(n,t){n.dom().appendChild(t.dom())},ce={before:ue,after:function(n,t){lt.nextSibling(n).fold(function(){lt.parent(n).each(function(n){ae(n,t)})},function(n){ue(n,t)})},prepend:function(t,e){lt.firstChild(t).fold(function(){ae(t,e)},function(n){t.dom().insertBefore(e.dom(),n.dom())})},append:ae,appendAt:function(n,t,e){lt.child(n,e).fold(function(){ae(n,t)},function(n){ue(n,t)})},wrap:function(n,t){ue(n,t),ae(t,n)}},le={before:function(t,n){B.each(n,function(n){ce.before(t,n)})},after:function(r,o){B.each(o,function(n,t){var e=0===t?r:o[t-1];ce.after(e,n)})},prepend:function(t,n){B.each(n.slice().reverse(),function(n){ce.prepend(t,n)})},append:function(t,n){B.each(n,function(n){ce.append(t,n)})}},se=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},fe={empty:function(n){n.dom().textContent="",B.each(lt.children(n),function(n){se(n)})},remove:se,unwrap:function(n){var t=lt.children(n);0<t.length&&le.before(n,t),se(n)}},de=V.immutable("minRow","minCol","maxRow","maxCol"),me=function(n,t){var e,i,r,u,a,c,l,o,s,f,d=function(n){return ln.is(n.element(),t)},m=Yt(n),g=Qt.generate(m),h=(i=d,r=(e=g).grid().columns(),u=e.grid().rows(),a=r,l=c=0,q.each(e.access(),function(n){if(i(n)){var t=n.row(),e=t+n.rowspan()-1,r=n.column(),o=r+n.colspan()-1;t<u?u=t:c<e&&(c=e),r<a?a=r:l<o&&(l=o)}}),de(u,a,c,l)),p="th:not("+t+"),td:not("+t+")",v=ft.filterFirstLayer(n,"th,td",function(n){return ln.is(n,p)});return B.each(v,fe.remove),function(n,t,e,r){for(var o,i,u,a=t.grid().columns(),c=t.grid().rows(),l=0;l<c;l++)for(var s=!1,f=0;f<a;f++)l<e.minRow()||l>e.maxRow()||f<e.minCol()||f>e.maxCol()||(Qt.getAt(t,l,f).filter(r).isNone()?(o=s,i=n[l].element(),u=nn.fromTag("td"),ce.append(u,nn.fromTag("br")),(o?ce.append:ce.prepend)(i,u)):s=!0)}(m,g,h,d),o=n,s=h,f=B.filter(ft.firstLayer(o,"tr"),function(n){return 0===n.dom().childElementCount}),B.each(f,fe.remove),s.minCol()!==s.maxCol()&&s.minRow()!==s.maxRow()||B.each(ft.firstLayer(o,"th,td"),function(n){St.remove(n,"rowspan"),St.remove(n,"colspan")}),St.remove(o,"width"),St.remove(o,"height"),ie.remove(o,"width"),ie.remove(o,"height"),n},ge=function(n,t){return nn.fromDom(n.dom().cloneNode(t))},he=function(n){return ge(n,!0)},pe=function(n,t){var e=nn.fromTag(t),r=St.clone(n);return St.setAll(e,r),e},ve=function(n){return ge(n,!1)},be=he,we=function(n,t){var e=pe(n,t),r=lt.children(he(n));return le.append(e,r),e},ye=(Et=bt.isText,Bt="text",Pt=function(n){return Et(n)?x.from(n.dom().nodeValue):x.none()},It=Qn.detect().browser,{get:function(n){if(!Et(n))throw new Error("Can only get "+Bt+" value of a "+Bt+" node");return Wt(n).getOr("")},getOption:Wt=It.isIE()&&10===It.version.major?function(n){try{return Pt(n)}catch(n){return x.none()}}:Pt,set:function(n,t){if(!Et(n))throw new Error("Can only set raw "+Bt+" value of a "+Bt+" node");n.dom().nodeValue=t}}),xe={get:function(n){return ye.get(n)},getOption:function(n){return ye.getOption(n)},set:function(n,t){ye.set(n,t)}},Ce=function(n){return"img"===bt.name(n)?1:xe.getOption(n).fold(function(){return lt.children(n).length},function(n){return n.length})},Se=["img","br"],Re=Ce,Te=function(n){return xe.getOption(n).filter(function(n){return 0!==n.trim().length||-1<n.indexOf("Â ")}).isSome()||B.contains(Se,bt.name(n))},De=function(n,i){var u=function(n){for(var t=lt.children(n),e=t.length-1;0<=e;e--){var r=t[e];if(i(r))return x.some(r);var o=u(r);if(o.isSome())return o}return x.none()};return u(n)},Ae={first:function(n){return jt.descendant(n,Te)},last:function(n){return De(n,Te)}},ke=function(){var n=nn.fromTag("td");return ce.append(n,nn.fromTag("br")),n},Oe=function(n,t,e){var r=we(n,t);return q.each(e,function(n,t){null===n?St.remove(r,t):St.set(r,t,n)}),r},Ne=function(n){return n},Ee=function(n){return function(){return nn.fromTag("tr",n.dom())}},Be=function(c,n,l){return{row:Ee(n),cell:function(n){var r,o,i,t=lt.owner(n.element()),e=nn.fromTag(bt.name(n.element()),t.dom()),u=l.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),a=0<u.length?(r=n.element(),o=e,i=u,Ae.first(r).map(function(n){var t=i.join(","),e=Ot.ancestors(n,t,function(n){return tt.eq(n,r)});return B.foldr(e,function(n,t){var e=ve(t);return ce.append(n,e),e},o)}).getOr(o)):e;return ce.append(a,nn.fromTag("br")),ie.copy(n.element(),e),ie.remove(e,"height"),1!==n.colspan()&&ie.remove(n.element(),"width"),c(n.element(),e),e},replace:Oe,gap:ke}},Pe=function(n){return{row:Ee(n),cell:ke,replace:Ne,gap:ke}},Ie=function(n,t){var e=(t||document).createElement("div");return e.innerHTML=n,lt.children(nn.fromDom(e))},We=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function Me(){return{up:y.constant({selector:zt.ancestor,closest:zt.closest,predicate:jt.ancestor,all:lt.parents}),down:y.constant({selector:Ot.descendants,predicate:kt.descendants}),styles:y.constant({get:ie.get,getRaw:ie.getRaw,set:ie.set,remove:ie.remove}),attrs:y.constant({get:St.get,set:St.set,remove:St.remove,copyTo:function(n,t){var e=St.clone(n);St.setAll(t,e)}}),insert:y.constant({before:ce.before,after:ce.after,afterAll:le.after,append:ce.append,appendAll:le.append,prepend:ce.prepend,wrap:ce.wrap}),remove:y.constant({unwrap:fe.unwrap,remove:fe.remove}),create:y.constant({nu:nn.fromTag,clone:function(n){return nn.fromDom(n.dom().cloneNode(!1))},text:nn.fromText}),query:y.constant({comparePosition:function(n,t){return n.dom().compareDocumentPosition(t.dom())},prevSibling:lt.prevSibling,nextSibling:lt.nextSibling}),property:y.constant({children:lt.children,name:bt.name,parent:lt.parent,isText:bt.isText,isComment:bt.isComment,isElement:bt.isElement,getText:xe.get,setText:xe.set,isBoundary:function(n){return!!bt.isElement(n)&&("body"===bt.name(n)||B.contains(We,bt.name(n)))},isEmptyTag:function(n){return!!bt.isElement(n)&&B.contains(["br","img","hr","input"],bt.name(n))}}),eq:tt.eq,is:tt.is}}var Le=V.immutable("left","right"),qe=function(n,t,e){var r=n.property().children(t);return B.findIndex(r,y.curry(n.eq,e)).map(function(n){return{before:y.constant(r.slice(0,n)),after:y.constant(r.slice(n+1))}})},je=function(e,r,o){return qe(e,r,o).map(function(n){var t=e.create().clone(r);return e.insert().appendAll(t,n.before().concat([o])),e.insert().appendAll(r,n.after()),e.insert().before(r,t),Le(t,r)})},_e=function(e,r,n){return qe(e,r,n).map(function(n){var t=e.create().clone(r);return e.insert().appendAll(t,n.after()),e.insert().after(r,t),Le(r,t)})},ze=function(i,n,u,a){var r=V.immutable("first","second","splits"),c=function(n,t,o){var e=r(n,x.none(),o);return u(n)?r(n,t,o):i.property().parent(n).bind(function(r){return a(i,r,n).map(function(n){var t=[{first:n.left,second:n.right}],e=u(r)?r:n.left();return c(e,x.some(n.right()),o.concat(t))}).getOr(e)})};return c(n,x.none(),[])},Fe=function(r,o,n,t){var e=o(r,n);return B.foldr(t,function(n,t){var e=o(r,t);return He(r,n,e)},e)},He=function(t,n,e){return n.bind(function(n){return e.filter(y.curry(t.eq,n))})},Ue=function(n,t,e){return 0<e.length?Fe(n,t,(r=e)[0],r.slice(1)):x.none();var r},Ve=function(n,t){return y.curry(n.eq,t)},Ge=function(t,n,e,r){var o=void 0!==r?r:y.constant(!1),i=[n].concat(t.up().all(n)),u=[e].concat(t.up().all(e)),a=function(t){return B.findIndex(t,o).fold(function(){return t},function(n){return t.slice(0,n+1)})},c=a(i),l=a(u),s=B.find(c,function(n){return B.exists(l,Ve(t,n))});return{firstpath:y.constant(c),secondpath:y.constant(l),shared:y.constant(s)}},Xe=function(t,n,e){var r=Ge(t,n,e);return r.shared().bind(function(n){return function(o,i,n,t){var u=o.property().children(i);if(o.eq(i,n[0]))return x.some([n[0]]);if(o.eq(i,t[0]))return x.some([t[0]]);var e=function(n){var t=B.reverse(n),e=B.findIndex(t,Ve(o,i)).getOr(-1),r=e<t.length-1?t[e+1]:t[e];return B.findIndex(u,Ve(o,r))},r=e(n),a=e(t);return r.bind(function(r){return a.map(function(n){var t=Math.min(r,n),e=Math.max(r,n);return u.slice(t,e+1)})})}(t,n,r.firstpath(),r.secondpath())})},Ye=Ge,Ke=function(n,t,e){return Ue(n,t,e)},$e=function(n,t,e){return Xe(n,t,e)},Je=function(n,t,e,r){return Ye(n,t,e,r)},Qe=function(n,t,e){return je(n,t,e)},Ze=function(n,t,e){return _e(n,t,e)},nr=function(n,t,e,r){return ze(n,t,e,r)},tr=Me(),er={sharedOne:function(e,n){return Ke(tr,function(n,t){return e(t)},n)},subset:function(n,t){return $e(tr,n,t)},ancestors:function(n,t,e){return Je(tr,n,t,e)},breakToLeft:function(n,t){return Qe(tr,n,t)},breakToRight:function(n,t){return Ze(tr,n,t)},breakPath:function(n,t,r){return nr(tr,n,t,function(n,t,e){return r(t,e)})}},rr=function(n,t){return t.column()>=n.startCol()&&t.column()+t.colspan()-1<=n.finishCol()&&t.row()>=n.startRow()&&t.row()+t.rowspan()-1<=n.finishRow()},or=function(n,t){var e=t.column(),r=t.column()+t.colspan()-1,o=t.row(),i=t.row()+t.rowspan()-1;return e<=n.finishCol()&&r>=n.startCol()&&o<=n.finishRow()&&i>=n.startRow()},ir=function(n,t){for(var e=!0,r=y.curry(rr,t),o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)e=e&&Qt.getAt(n,o,i).exists(r);return e?x.some(t):x.none()},ur=function(n,t,e){var r=Qt.findItem(n,t,tt.eq),o=Qt.findItem(n,e,tt.eq);return r.bind(function(r){return o.map(function(n){return t=r,e=n,Q.bounds(Math.min(t.row(),e.row()),Math.min(t.column(),e.column()),Math.max(t.row()+t.rowspan()-1,e.row()+e.rowspan()-1),Math.max(t.column()+t.colspan()-1,e.column()+e.colspan()-1));var t,e})})},ar=ur,cr=function(t,n,e){return ur(t,n,e).bind(function(n){return ir(t,n)})},lr=function(r,n,o,i){return Qt.findItem(r,n,tt.eq).bind(function(n){var t=0<o?n.row()+n.rowspan()-1:n.row(),e=0<i?n.column()+n.colspan()-1:n.column();return Qt.getAt(r,t+o,e+i).map(function(n){return n.element()})})},sr=function(e,n,t){return ar(e,n,t).map(function(n){var t=Qt.filterItems(e,y.curry(or,n));return B.map(t,function(n){return n.element()})})},fr=function(n,t){return Qt.findItem(n,t,function(n,t){return tt.contains(t,n)}).bind(function(n){return n.element()})},dr=function(n){var t=Yt(n);return Qt.generate(t)},mr=function(e,r,o){return Xt.table(e).bind(function(n){var t=dr(n);return lr(t,e,r,o)})},gr=function(n,t,e){var r=dr(n);return sr(r,t,e)},hr=function(n,t,e,r,o){var i=dr(n),u=tt.eq(n,e)?t:fr(i,t),a=tt.eq(n,o)?r:fr(i,r);return sr(i,u,a)},pr=function(n,t,e){var r=dr(n);return cr(r,t,e)},vr=function(n,t){return zt.ancestor(n,"table")},br=V.immutableBag(["boxes","start","finish"],[]),wr=function(a,c,r){var l=function(t){return function(n){return r(n)||tt.eq(n,t)}};return tt.eq(a,c)?x.some(br({boxes:x.some([a]),start:a,finish:c})):vr(a).bind(function(u){return vr(c).bind(function(i){if(tt.eq(u,i))return x.some(br({boxes:gr(u,a,c),start:a,finish:c}));if(tt.contains(u,i)){var n=0<(t=Ot.ancestors(c,"td,th",l(u))).length?t[t.length-1]:c;return x.some(br({boxes:hr(u,a,u,c,i),start:a,finish:n}))}if(tt.contains(i,u)){var t,e=0<(t=Ot.ancestors(a,"td,th",l(i))).length?t[t.length-1]:a;return x.some(br({boxes:hr(i,a,u,c,i),start:a,finish:e}))}return er.ancestors(a,c).shared().bind(function(n){return zt.closest(n,"table",r).bind(function(n){var t=Ot.ancestors(c,"td,th",l(n)),e=0<t.length?t[t.length-1]:c,r=Ot.ancestors(a,"td,th",l(n)),o=0<r.length?r[r.length-1]:a;return x.some(br({boxes:hr(n,a,u,c,i),start:o,finish:e}))})})})})},yr=wr,xr=function(n,t){var e=Ot.descendants(n,t);return 0<e.length?x.some(e):x.none()},Cr=function(n,t,e,r,o){return(i=n,u=o,B.find(i,function(n){return ln.is(n,u)})).bind(function(n){return mr(n,t,e).bind(function(n){return t=n,e=r,zt.ancestor(t,"table").bind(function(n){return zt.descendant(n,e).bind(function(n){return wr(n,t).bind(function(t){return t.boxes().map(function(n){return{boxes:y.constant(n),start:y.constant(t.start()),finish:y.constant(t.finish())}})})})});var t,e})});var i,u},Sr=function(n,t,r){return zt.descendant(n,t).bind(function(e){return zt.descendant(n,r).bind(function(t){return er.sharedOne(vr,[e,t]).map(function(n){return{first:y.constant(e),last:y.constant(t),table:y.constant(n)}})})})},Rr=function(n,t){return xr(n,t)},Tr=function(o,n,t){return Sr(o,n,t).bind(function(e){var n=function(n){return tt.eq(o,n)},t=zt.ancestor(e.first(),"thead,tfoot,tbody,table",n),r=zt.ancestor(e.last(),"thead,tfoot,tbody,table",n);return t.bind(function(t){return r.bind(function(n){return tt.eq(t,n)?pr(e.table(),e.first(),e.last()):x.none()})})})},Dr="data-mce-selected",Ar="data-mce-first-selected",kr="data-mce-last-selected",Or={selected:y.constant(Dr),selectedSelector:y.constant("td[data-mce-selected],th[data-mce-selected]"),attributeSelector:y.constant("[data-mce-selected]"),firstSelected:y.constant(Ar),firstSelectedSelector:y.constant("td[data-mce-first-selected],th[data-mce-first-selected]"),lastSelected:y.constant(kr),lastSelectedSelector:y.constant("td[data-mce-last-selected],th[data-mce-last-selected]")},Nr=function(u){if(!p.isArray(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],e={};return B.each(u,function(n,r){var t=q.keys(n);if(1!==t.length)throw new Error("one and only one name per case");var o=t[0],i=n[o];if(void 0!==e[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!p.isArray(i))throw new Error("case arguments must be an array");a.push(o),e[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var e=new Array(n),t=0;t<e.length;t++)e[t]=arguments[t];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[r].apply(null,e)},match:function(n){var t=q.keys(n);if(a.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+t.join(","));if(!B.forall(a,function(n){return B.contains(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,e)},log:function(n){console.log(n,{constructors:a,constructor:o,params:e})}}}}),e},Er=Nr([{none:[]},{multiple:["elements"]},{single:["selection"]}]),Br={cata:function(n,t,e,r){return n.fold(t,e,r)},none:Er.none,multiple:Er.multiple,single:Er.single},Pr=function(n,t){return Br.cata(t.get(),y.constant([]),y.identity,y.constant([n]))},Ir=function(e,n){return Br.cata(n.get(),x.none,function(t,n){return 0===t.length?x.none():Tr(e,Or.firstSelectedSelector(),Or.lastSelectedSelector()).bind(function(n){return 1<t.length?x.some({bounds:y.constant(n),cells:y.constant(t)}):x.none()})},x.none)},Wr=function(n,t){var e=Pr(n,t);return 0<e.length&&B.forall(e,function(n){return St.has(n,"rowspan")&&1<parseInt(St.get(n,"rowspan"),10)||St.has(n,"colspan")&&1<parseInt(St.get(n,"colspan"),10)})?x.some(e):x.none()},Mr=Pr,Lr=function(n){return{element:y.constant(n),mergable:x.none,unmergable:x.none,selection:y.constant([n])}},qr=V.immutable("element","clipboard","generators"),jr={noMenu:Lr,forMenu:function(n,t,e){return{element:y.constant(e),mergable:y.constant(Ir(t,n)),unmergable:y.constant(Wr(e,n)),selection:y.constant(Mr(e,n))}},notCell:function(n){return Lr(n)},paste:qr,pasteRows:function(n,t,e,r,o){return{element:y.constant(e),mergable:x.none,unmergable:x.none,selection:y.constant(Mr(e,n)),clipboard:y.constant(r),generators:y.constant(o)}}},_r=function(a,n,c,l){a.on("BeforeGetContent",function(e){!0===e.selection&&Br.cata(n.get(),y.noop,function(n){var t;e.preventDefault(),(t=n,Xt.table(t[0]).map(be).map(function(n){return[me(n,Or.attributeSelector())]})).each(function(n){e.content=B.map(n,function(n){return t=n,a.selection.serializer.serialize(t.dom(),{});var t}).join("")})},y.noop)}),a.on("BeforeSetContent",function(u){!0===u.selection&&!0===u.paste&&x.from(a.dom.getParent(a.selection.getStart(),"th,td")).each(function(n){var i=nn.fromDom(n);Xt.table(i).bind(function(t){var n=B.filter(Ie(u.content),function(n){return"meta"!==bt.name(n)});if(1===n.length&&"table"===bt.name(n[0])){u.preventDefault();var e=nn.fromDom(a.getDoc()),r=Pe(e),o=jr.paste(i,n[0],r);c.pasteCells(t,o).each(function(n){a.selection.setRng(n),a.focus(),l.clear(t)})}})})})};function zr(r,o){var n=function(n){var t=o(n);if(t<=0||null===t){var e=ie.get(n,r);return parseFloat(e)||0}return t},i=function(o,n){return B.foldl(n,function(n,t){var e=ie.get(o,t),r=void 0===e?0:parseInt(e,10);return isNaN(r)?n:n+r},0)};return{set:function(n,t){if(!p.isNumber(t)&&!t.match(/^[0-9]+$/))throw r+".set accepts only positive integer values. Value was "+t;var e=n.dom();Zt(e)&&(e.style[r]=t+"px")},get:n,getOuter:n,aggregate:i,max:function(n,t,e){var r=i(n,e);return r<t?t-r:0}}}var Fr=zr("height",function(n){return Dt.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight}),Hr=function(n){return Fr.get(n)},Ur=function(n){return Fr.getOuter(n)},Vr=zr("width",function(n){return n.dom().offsetWidth}),Gr=function(n){return Vr.get(n)},Xr=function(n){return Vr.getOuter(n)},Yr=Qn.detect(),Kr=function(n,t,e){return r=ie.get(n,t),o=e,i=parseFloat(r),isNaN(i)?o:i;var r,o,i},$r=function(n){return Yr.browser.isIE()||Yr.browser.isEdge()?(e=Kr(t=n,"padding-top",0),r=Kr(t,"padding-bottom",0),o=Kr(t,"border-top-width",0),i=Kr(t,"border-bottom-width",0),u=t.dom().getBoundingClientRect().height,"border-box"===ie.get(t,"box-sizing")?u:u-e-r-(o+i)):Kr(n,"height",Hr(n));var t,e,r,o,i,u},Jr=/(\d+(\.\d+)?)(\w|%)*/,Qr=/(\d+(\.\d+)?)%/,Zr=/(\d+(\.\d+)?)px|em/,no=function(n,t){ie.set(n,"height",t+"px")},to=function(n,t,e,r){var o,i,u,a,c,l=parseInt(n,10);return Vn.endsWith(n,"%")&&"table"!==bt.name(t)?(o=t,i=l,u=e,a=r,c=Xt.table(o).map(function(n){var t=u(n);return Math.floor(i/100*t)}).getOr(i),a(o,c),c):l},eo=function(n){var t,e=(t=n,ie.getRaw(t,"height").getOrThunk(function(){return $r(t)+"px"}));return e?to(e,n,Hr,no):Hr(n)},ro=function(n,t){return St.has(n,t)?parseInt(St.get(n,t),10):1},oo=function(n){return ie.getRaw(n,"width").fold(function(){return x.from(St.get(n,"width"))},function(n){return x.some(n)})},io=function(n,t){return n/t.pixelWidth()*100},uo={percentageBasedSizeRegex:y.constant(Qr),pixelBasedSizeRegex:y.constant(Zr),setPixelWidth:function(n,t){ie.set(n,"width",t+"px")},setPercentageWidth:function(n,t){ie.set(n,"width",t+"%")},setHeight:no,getPixelWidth:function(t,e){return oo(t).fold(function(){var n=Gr(t);return parseInt(n,10)},function(n){return function(n,t,e){if(Zr.test(t)){var r=Zr.exec(t);return parseInt(r[1],10)}if(Qr.test(t)){var o=Qr.exec(t),i=parseFloat(o[1]);return i/100*e.pixelWidth()}var u=Gr(n);return parseInt(u,10)}(t,n,e)})},getPercentageWidth:function(e,r){return oo(e).fold(function(){var n=Gr(e),t=parseInt(n,10);return io(t,r)},function(n){return function(n,t,e){if(Qr.test(t)){var r=Qr.exec(t);return parseFloat(r[1])}var o=Gr(n),i=parseInt(o,10);return io(i,e)}(e,n,r)})},getGenericWidth:function(n){return oo(n).bind(function(n){if(Jr.test(n)){var t=Jr.exec(n);return x.some({width:y.constant(t[1]),unit:y.constant(t[3])})}return x.none()})},setGenericWidth:function(n,t,e){ie.set(n,"width",t+e)},getHeight:function(n){return e="rowspan",eo(t=n)/ro(t,e);var t,e},getRawWidth:oo},ao=function(e,r){uo.getGenericWidth(e).each(function(n){var t=n.width()/2;uo.setGenericWidth(e,t,n.unit()),uo.setGenericWidth(r,t,n.unit())})},co=function(n,t){var e=t||nn.fromDom(document.documentElement);return jt.ancestor(n,y.curry(tt.eq,e)).isSome()},lo=function(n){var t=n.dom();return t===t.window?n:bt.isDocument(n)?t.defaultView||t.parentWindow:null},so=function(e,r){return{left:y.constant(e),top:y.constant(r),translate:function(n,t){return so(e+n,r+t)}}},fo=function(n,t){return void 0!==n?n:void 0!==t?t:0},mo=function(n){var t,e=n.dom(),r=e.ownerDocument,o=r.body,i=nn.fromDom(r.documentElement);return o===e?so(o.offsetLeft,o.offsetTop):co(n,i)?(t=e.getBoundingClientRect(),so(t.left,t.top)):so(0,0)},go=function(n){var t=n.dom().ownerDocument,e=t.body,r=lo(nn.fromDom(t)),o=t.documentElement,i=fo(r.pageYOffset,o.scrollTop),u=fo(r.pageXOffset,o.scrollLeft),a=fo(o.clientTop,e.clientTop),c=fo(o.clientLeft,e.clientLeft);return mo(n).translate(u-c,i-a)},ho=V.immutable("row","y"),po=V.immutable("col","x"),vo=function(n){return go(n).left()+Xr(n)},bo=function(n){return go(n).left()},wo=function(n,t){return po(n,bo(t))},yo=function(n,t){return po(n,vo(t))},xo=function(n){return go(n).top()},Co=function(e,t,r){if(0===r.length)return[];var n=B.map(r.slice(1),function(n,t){return n.map(function(n){return e(t,n)})}),o=r[r.length-1].map(function(n){return t(r.length-1,n)});return n.concat([o])},So={delta:y.identity,positions:y.curry(Co,function(n,t){return ho(n,xo(t))},function(n,t){return ho(n,xo(t)+Ur(t))}),edge:xo},Ro={delta:y.identity,edge:bo,positions:y.curry(Co,wo,yo)},To={height:So,rtl:{delta:function(n,t){return-n},edge:vo,positions:y.curry(Co,yo,wo)},ltr:Ro},Do={ltr:To.ltr,rtl:To.rtl};function Ao(t){var e=function(n){return t(n).isRtl()?Do.rtl:Do.ltr};return{delta:function(n,t){return e(t).delta(n,t)},edge:function(n){return e(n).edge(n)},positions:function(n,t){return e(t).positions(n,t)}}}var ko=function(n){var t=Yt(n);return Qt.generate(t).grid()},Oo=function(n){var t=n,e=function(){return t};return{get:e,set:function(n){t=n},clone:function(){return Oo(e())}}},No=function(n,t){return Eo(n,t,{validate:p.isFunction,label:"function"})},Eo=function(r,o,i){if(0===o.length)throw new Error("You must specify at least one required field.");return F("required",o),U(o),function(t){var e=q.keys(t);B.forall(o,function(n){return B.contains(e,n)})||_(o,e),r(o,e);var n=B.filter(o,function(n){return!i.validate(t[n],n)});return 0<n.length&&H(n,i.label),t}},Bo=y.noop,Po={exactly:y.curry(No,function(t,n){var e=B.filter(n,function(n){return!B.contains(t,n)});0<e.length&&z(e)}),ensure:y.curry(No,Bo),ensureWith:y.curry(Eo,Bo)},Io=function(n){var t=St.has(n,"colspan")?parseInt(St.get(n,"colspan"),10):1,e=St.has(n,"rowspan")?parseInt(St.get(n,"rowspan"),10):1;return{element:y.constant(n),colspan:y.constant(t),rowspan:y.constant(e)}},Wo=Po.exactly(["cell","row","replace","gap"]),Mo=function(r,n){Wo(r);var e=Oo(x.none()),o=void 0!==n?n:Io,i=function(n){var t,e=o(n);return t=e,r.cell(t)},u=function(n){var t=i(n);return e.get().isNone()&&e.set(x.some(t)),a=x.some({item:n,replacement:t}),t},a=x.none();return{getOrInit:function(t,e){return a.fold(function(){return u(t)},function(n){return e(t,n.item)?n.replacement:u(t)})},cursor:e.get}},Lo=function(o,a){return function(e){var r=Oo(x.none());Wo(e);var i=[],u=function(n){var t=e.replace(n,a,{scope:o});return i.push({item:n,sub:t}),r.get().isNone()&&r.set(x.some(t)),t};return{replaceOrInit:function(t,e){return(r=t,o=e,B.find(i,function(n){return o(n.item,r)})).fold(function(){return u(t)},function(n){return e(t,n.item)?n.sub:u(t)});var r,o},cursor:r.get}}},qo=function(e){Wo(e);var n=Oo(x.none());return{combine:function(t){return n.get().isNone()&&n.set(x.some(t)),function(){var n=e.cell({element:y.constant(t),colspan:y.constant(1),rowspan:y.constant(1)});return ie.remove(n,"width"),ie.remove(t,"width"),n}},cursor:n.get}},jo=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],_o=function(n,t){var e=n.property().name(t);return B.contains(jo,e)},zo=function(n,t){return B.contains(["br","img","hr","input"],n.property().name(t))},Fo=_o,Ho=function(n,t){var e=n.property().name(t);return B.contains(["ol","ul"],e)},Uo=zo,Vo=Me(),Go=function(n){return Fo(Vo,n)},Xo=function(n){return Ho(Vo,n)},Yo=function(n){return Uo(Vo,n)},Ko=function(n){var t,i=function(n){return"br"===bt.name(n)},r=function(o){return Ae.last(o).bind(function(e){var n,r=(n=e,lt.nextSibling(n).map(function(n){return!!Go(n)||(Yo(n)?"img"!==bt.name(n):void 0)}).getOr(!1));return lt.parent(e).map(function(n){return!0===r||(t=n,"li"===bt.name(t)||jt.ancestor(t,Xo).isSome())||i(e)||Go(n)&&!tt.eq(o,n)?[]:[nn.fromTag("br")];var t})}).getOr([])},e=0===(t=B.bind(n,function(n){var t,e=lt.children(n);return t=e,B.forall(t,function(n){return i(n)||bt.isText(n)&&0===xe.get(n).trim().length})?[]:e.concat(r(n))})).length?[nn.fromTag("br")]:t;fe.empty(n[0]),le.append(n[0],e)},$o=function(u){return function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<n.length;r++){var o=n[r];for(var i in o)o.hasOwnProperty(i)&&(e[i]=u(e[i],o[i]))}return e}},Jo=$o(function(n,t){return p.isObject(n)&&p.isObject(t)?Jo(n,t):t}),Qo=$o(function(n,t){return t}),Zo={deepMerge:Jo,merge:Qo},ni=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},ti=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return x.none()},ei=function(n,t){return Q.rowcells(t,n.section())},ri=function(n,t){return n.cells()[t]},oi={addCell:function(n,t,e){var r=n.cells(),o=r.slice(0,t),i=r.slice(t),u=o.concat([e]).concat(i);return ei(n,u)},setCells:ei,mutateCell:function(n,t,e){n.cells()[t]=e},getCell:ri,getCellElement:function(n,t){return ri(n,t).element()},mapCells:function(n,t){var e=n.cells(),r=B.map(e,t);return Q.rowcells(r,n.section())},cellLength:function(n){return n.cells().length}},ii=function(n,t){if(0===n.length)return 0;var e=n[0];return B.findIndex(n,function(n){return!t(e.element(),n.element())}).fold(function(){return n.length},function(n){return n})},ui=function(n,t,e,r){var o,i,u,a,c=(o=n,i=t,o[i]).cells().slice(e),l=ii(c,r),s=(u=n,a=e,B.map(u,function(n){return oi.getCell(n,a)})).slice(t),f=ii(s,r);return{colspan:y.constant(l),rowspan:y.constant(f)}},ai=function(o,i){var u=B.map(o,function(n,t){return B.map(n.cells(),function(n,t){return!1})});return B.map(o,function(n,r){var t=B.bind(n.cells(),function(n,t){if(!1===u[r][t]){var e=ui(o,r,t,i);return function(n,t,e,r){for(var o=n;o<n+e;o++)for(var i=t;i<t+r;i++)u[o][i]=!0}(r,t,e.rowspan(),e.colspan()),[Q.detailnew(n.element(),e.rowspan(),e.colspan(),n.isNew())]}return[]});return Q.rowdetails(t,n.section())})},ci=function(n,t,e){for(var r=[],o=0;o<n.grid().rows();o++){for(var i=[],u=0;u<n.grid().columns();u++){var a=Qt.getAt(n,o,u).map(function(n){return Q.elementnew(n.element(),e)}).getOrThunk(function(){return Q.elementnew(t.gap(),!0)});i.push(a)}var c=Q.rowcells(i,n.all()[o].section());r.push(c)}return r},li=function(n,t,e,r){e===r?St.remove(n,t):St.set(n,t,e)},si=function(o,n){var i=[],u=[],t=function(n,t){var e;0<n.length?function(n,t){var e=zt.child(o,t).getOrThunk(function(){var n=nn.fromTag(t,lt.owner(o).dom());return ce.append(o,n),n});fe.empty(e);var r=B.map(n,function(n){n.isNew()&&i.push(n.element());var t=n.element();return fe.empty(t),B.each(n.cells(),function(n){n.isNew()&&u.push(n.element()),li(n.element(),"colspan",n.colspan(),1),li(n.element(),"rowspan",n.rowspan(),1),ce.append(t,n.element())}),t});le.append(e,r)}(n,t):(e=t,zt.child(o,e).bind(fe.remove))},e=[],r=[],a=[];return B.each(n,function(n){switch(n.section()){case"thead":e.push(n);break;case"tbody":r.push(n);break;case"tfoot":a.push(n)}}),t(e,"thead"),t(r,"tbody"),t(a,"tfoot"),{newRows:y.constant(i),newCells:y.constant(u)}},fi=function(n){return B.map(n,function(n){var e=ve(n.element());return B.each(n.cells(),function(n){var t=be(n.element());li(t,"colspan",n.colspan(),1),li(t,"rowspan",n.rowspan(),1),ce.append(e,t)}),e})},di=function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},mi=function(n,t){for(var e=[],r=n;r<t;r++)e.push(r);return e},gi=function(t,e){if(e<0||e>=t.length-1)return x.none();var n=t[e].fold(function(){var n=B.reverse(t.slice(0,e));return ti(n,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return x.some({value:n,delta:0})}),r=t[e+1].fold(function(){var n=t.slice(e+1);return ti(n,function(n,t){return n.map(function(n){return{value:n,delta:t+1}})})},function(n){return x.some({value:n,delta:1})});return n.bind(function(e){return r.map(function(n){var t=n.delta+e.delta;return Math.abs(n.value-e.value)/t})})},hi=function(n,t,e){var r=n();return B.find(r,t).orThunk(function(){return x.from(r[0]).orThunk(e)}).map(function(n){return n.element()})},pi=function(e){var n=e.grid(),t=mi(0,n.columns()),r=mi(0,n.rows());return B.map(t,function(t){return hi(function(){return B.bind(r,function(n){return Qt.getAt(e,n,t).filter(function(n){return n.column()===t}).fold(y.constant([]),function(n){return[n]})})},function(n){return 1===n.colspan()},function(){return Qt.getAt(e,0,t)})})},vi=function(e){var n=e.grid(),t=mi(0,n.rows()),r=mi(0,n.columns());return B.map(t,function(t){return hi(function(){return B.bind(r,function(n){return Qt.getAt(e,t,n).filter(function(n){return n.row()===t}).fold(y.constant([]),function(n){return[n]})})},function(n){return 1===n.rowspan()},function(){return Qt.getAt(e,t,0)})})},bi=function(n,t,e,r,o){var i=nn.fromTag("div");return ie.setAll(i,{position:"absolute",left:t-r/2+"px",top:e+"px",height:o+"px",width:r+"px"}),St.setAll(i,{"data-column":n,role:"presentation"}),i},wi=function(n,t,e,r,o){var i=nn.fromTag("div");return ie.setAll(i,{position:"absolute",left:t+"px",top:e-o/2+"px",height:o+"px",width:r+"px"}),St.setAll(i,{"data-row":n,role:"presentation"}),i},yi=function(n){var t=n.replace(/\./g,"-");return{resolve:function(n){return t+"-"+n}}},xi={resolve:yi("ephox-snooker").resolve},Ci=function(n,t){var e=St.get(n,t);return void 0===e||""===e?[]:e.split(" ")},Si=Ci,Ri=function(n,t,e){var r=Ci(n,t).concat([e]);St.set(n,t,r.join(" "))},Ti=function(n,t,e){var r=B.filter(Ci(n,t),function(n){return n!==e});0<r.length?St.set(n,t,r.join(" ")):St.remove(n,t)},Di=function(n){return Si(n,"class")},Ai=function(n,t){return Ri(n,"class",t)},ki=function(n,t){return Ti(n,"class",t)},Oi=Di,Ni=Ai,Ei=ki,Bi=function(n,t){B.contains(Di(n),t)?ki(n,t):Ai(n,t)},Pi=function(n){return void 0!==n.dom().classList},Ii=function(n,t){return Pi(n)&&n.dom().classList.contains(t)},Wi={add:function(n,t){Pi(n)?n.dom().classList.add(t):Ni(n,t)},remove:function(n,t){var e;Pi(n)?n.dom().classList.remove(t):Ei(n,t),0===(Pi(e=n)?e.dom().classList:Oi(e)).length&&St.remove(e,"class")},toggle:function(n,t){return Pi(n)?n.dom().classList.toggle(t):Bi(n,t)},toggler:function(n,t){var e,r,o,i,u,a,c=Pi(n),l=n.dom().classList;return e=function(){c?l.remove(t):Ei(n,t)},r=function(){c?l.add(t):Ni(n,t)},o=Ii(n,t),i=o||!1,{on:u=function(){r(),i=!0},off:a=function(){e(),i=!1},toggle:function(){(i?a:u)()},isOn:function(){return i}}},has:Ii},Mi=xi.resolve("resizer-bar"),Li=xi.resolve("resizer-rows"),qi=xi.resolve("resizer-cols"),ji=function(n){var t=Ot.descendants(n.parent(),"."+Mi);B.each(t,fe.remove)},_i=function(e,n,r){var o=e.origin();B.each(n,function(n,t){n.each(function(n){var t=r(o,n);Wi.add(t,Mi),ce.append(e.parent(),t)})})},zi=function(n,t,e,r,o,i){var u,a,c,l,s=go(t),f=0<e.length?o.positions(e,t):[];u=n,a=f,c=s,l=Xr(t),_i(u,a,function(n,t){var e=wi(t.row(),c.left()-n.left(),t.y()-n.top(),l,7);return Wi.add(e,Li),e});var d,m,g,h,p=0<r.length?i.positions(r,t):[];d=n,m=p,g=s,h=Ur(t),_i(d,m,function(n,t){var e=bi(t.col(),t.x()-n.left(),g.top()-n.top(),7,h);return Wi.add(e,qi),e})},Fi=function(n,t){var e=Ot.descendants(n.parent(),"."+Mi);B.each(e,t)},Hi={refresh:function(n,t,e,r){ji(n);var o=Yt(t),i=Qt.generate(o),u=vi(i),a=pi(i);zi(n,t,u,a,e,r)},hide:function(n){Fi(n,function(n){ie.set(n,"display","none")})},show:function(n){Fi(n,function(n){ie.set(n,"display","block")})},destroy:ji,isRowBar:function(n){return Wi.has(n,Li)},isColBar:function(n){return Wi.has(n,qi)}},Ui=function(n,r){return B.map(n,function(n){var t,e=(t=n.details(),ti(t,function(n){return lt.parent(n.element()).map(function(n){var t=lt.parent(n).isNone();return Q.elementnew(n,t)})}).getOrThunk(function(){return Q.elementnew(r.row(),!0)}));return Q.rowdatanew(e.element(),n.details(),n.section(),e.isNew())})},Vi=function(n,t){var e=ai(n,tt.eq);return Ui(e,t)},Gi=function(n,t){var e=B.flatten(B.map(n.all(),function(n){return n.cells()}));return B.find(e,function(n){return tt.eq(t,n.element())})},Xi=function(a,c,l,s,f){return function(e,r,n,o,i){var t=Yt(r),u=Qt.generate(t);return c(u,n).map(function(n){var t=ci(u,o,!1),e=a(t,n,tt.eq,f(o)),r=Vi(e.grid(),o);return{grid:y.constant(r),cursor:e.cursor}}).fold(function(){return x.none()},function(n){var t=si(r,n.grid());return l(r,n.grid(),i),s(r),Hi.refresh(e,r,To.height,i),x.some({cursor:n.cursor,newRows:t.newRows,newCells:t.newCells})})}},Yi=Vi,Ki=function(t,n){return Xt.cell(n.element()).bind(function(n){return Gi(t,n)})},$i=function(t,n){var e=B.map(n.selection(),function(n){return Xt.cell(n).bind(function(n){return Gi(t,n)})}),r=ni(e);return 0<r.length?x.some(r):x.none()},Ji=function(t,e){return Xt.cell(e.element()).bind(function(n){return Gi(t,n).map(function(n){return Zo.merge(n,{generators:e.generators,clipboard:e.clipboard})})})},Qi=function(t,n){var e=B.map(n.selection(),function(n){return Xt.cell(n).bind(function(n){return Gi(t,n)})}),r=ni(e);return 0<r.length?x.some(Zo.merge({cells:r},{generators:n.generators,clipboard:n.clipboard})):x.none()},Zi=function(n,t){return t.mergable()},nu=function(n,t){return t.unmergable()},tu=function(e){return{is:function(n){return e===n},isValue:y.always,isError:y.never,getOr:y.constant(e),getOrThunk:y.constant(e),getOrDie:y.constant(e),or:function(n){return tu(e)},orThunk:function(n){return tu(e)},fold:function(n,t){return t(e)},map:function(n){return tu(n(e))},each:function(n){n(e)},bind:function(n){return n(e)},exists:function(n){return n(e)},forall:function(n){return n(e)},toOption:function(){return x.some(e)}}},eu=function(e){return{is:y.never,isValue:y.never,isError:y.always,getOr:y.identity,getOrThunk:function(n){return n()},getOrDie:function(){return y.die(String(e))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,t){return n(e)},map:function(n){return eu(e)},each:y.noop,bind:function(n){return eu(e)},exists:y.never,forall:y.always,toOption:x.none}},ru={value:tu,error:eu},ou=function(n,t){return B.map(n,function(){return Q.elementnew(t.cell(),!0)})},iu=function(t,n,e){return t.concat(di(n,function(n){return oi.setCells(t[t.length-1],ou(t[t.length-1].cells(),e))}))},uu=function(n,t,e){return B.map(n,function(n){return oi.setCells(n,n.cells().concat(ou(mi(0,t),e)))})},au=function(n,t,e){if(n.row()>=t.length||n.column()>oi.cellLength(t[0]))return ru.error("invalid start address out of table bounds, row: "+n.row()+", column: "+n.column());var r=t.slice(n.row()),o=r[0].cells().slice(n.column()),i=oi.cellLength(e[0]),u=e.length;return ru.value({rowDelta:y.constant(r.length-u),colDelta:y.constant(o.length-i)})},cu=function(n,t){var e=oi.cellLength(n[0]),r=oi.cellLength(t[0]);return{rowDelta:y.constant(0),colDelta:y.constant(e-r)}},lu=function(n,t,e){var r=t.colDelta()<0?uu:y.identity;return(t.rowDelta()<0?iu:y.identity)(r(n,Math.abs(t.colDelta()),e),Math.abs(t.rowDelta()),e)},su=function(n,t,e,r){if(0===n.length)return n;for(var o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)oi.mutateCell(n[o],i,Q.elementnew(r(),!1));return n},fu=function(n,t,e,r){for(var o=!0,i=0;i<n.length;i++)for(var u=0;u<oi.cellLength(n[0]);u++){var a=e(oi.getCellElement(n[i],u),t);!0===a&&!1===o?oi.mutateCell(n[i],u,Q.elementnew(r(),!0)):!0===a&&(o=!1)}return n},du=function(i,u,a,c){if(0<u&&u<i.length){var n=i[u-1].cells(),t=(e=n,r=a,B.foldl(e,function(n,t){return B.exists(n,function(n){return r(n.element(),t.element())})?n:n.concat([t])},[]));B.each(t,function(n){for(var t=x.none(),e=u;e<i.length;e++)for(var r=0;r<oi.cellLength(i[0]);r++){var o=i[e].cells()[r];a(o.element(),n.element())&&(t.isNone()&&(t=x.some(c())),t.each(function(n){oi.mutateCell(i[e],r,Q.elementnew(n,!0))}))}})}var e,r;return i},mu=function(e,r,o,i,u){return au(e,r,o).map(function(n){var t=lu(r,n,i);return function(n,t,e,r,o){for(var i,u,a,c,l,s,f,d=n.row(),m=n.column(),g=d+e.length,h=m+oi.cellLength(e[0]),p=d;p<g;p++)for(var v=m;v<h;v++){i=t,u=p,a=v,c=o,s=l=void 0,l=oi.getCell(i[u],a),s=y.curry(c,l.element()),f=i[u],1<i.length&&1<oi.cellLength(f)&&(0<a&&s(oi.getCellElement(f,a-1))||a<f.length-1&&s(oi.getCellElement(f,a+1))||0<u&&s(oi.getCellElement(i[u-1],a))||u<i.length-1&&s(oi.getCellElement(i[u+1],a)))&&fu(t,oi.getCellElement(t[p],v),o,r.cell);var b=oi.getCellElement(e[p-d],v-m),w=r.replace(b);oi.mutateCell(t[p],v,Q.elementnew(w,!0))}return t}(e,t,o,i,u)})},gu=function(n,t,e,r,o){du(t,n,o,r.cell);var i=cu(e,t),u=lu(e,i,r),a=cu(t,u),c=lu(t,a,r);return c.slice(0,n).concat(u).concat(c.slice(n,c.length))},hu=function(e,r,n,o,i){var t=e.slice(0,r),u=e.slice(r),a=oi.mapCells(e[n],function(n,t){return 0<r&&r<e.length&&o(oi.getCellElement(e[r-1],t),oi.getCellElement(e[r],t))?oi.getCell(e[r],t):Q.elementnew(i(n.element(),o),!0)});return t.concat([a]).concat(u)},pu=function(n,e,r,o,i){return B.map(n,function(n){var t=0<e&&e<oi.cellLength(n)&&o(oi.getCellElement(n,e-1),oi.getCellElement(n,e))?oi.getCell(n,e):Q.elementnew(i(oi.getCellElement(n,r),o),!0);return oi.addCell(n,e,t)})},vu=function(n,r,o,i,u){var a=o+1;return B.map(n,function(n,t){var e=t===r?Q.elementnew(u(oi.getCellElement(n,o),i),!0):oi.getCell(n,o);return oi.addCell(n,a,e)})},bu=function(n,t,e,r,o){var i=t+1,u=n.slice(0,i),a=n.slice(i),c=oi.mapCells(n[t],function(n,t){return t===e?Q.elementnew(o(n.element(),r),!0):n});return u.concat([c]).concat(a)},wu=function(n,t,e){return n.slice(0,t).concat(n.slice(e+1))},yu=function(n,e,r){var t=B.map(n,function(n){var t=n.cells().slice(0,e).concat(n.cells().slice(r+1));return Q.rowcells(t,n.section())});return B.filter(t,function(n){return 0<n.cells().length})},xu=function(n,e,r,o){return B.map(n,function(n){return oi.mapCells(n,function(n){return t=n,B.exists(e,function(n){return r(t.element(),n.element())})?Q.elementnew(o(n.element(),r),!0):n;var t})})},Cu=function(n,t,e,r){return void 0!==oi.getCellElement(n[t],e)&&0<t&&r(oi.getCellElement(n[t-1],e),oi.getCellElement(n[t],e))},Su=function(n,t,e){return 0<t&&e(oi.getCellElement(n,t-1),oi.getCellElement(n,t))},Ru=function(e,r,o,n){var t=B.bind(e,function(n,t){return Cu(e,t,r,o)||Su(n,r,o)?[]:[oi.getCell(n,r)]});return xu(e,t,o,n)},Tu=function(e,r,o,n){var i=e[r],t=B.bind(i.cells(),function(n,t){return Cu(e,r,t,o)||Su(i,t,o)?[]:[n]});return xu(e,t,o,n)},Du=function(n){return{fold:n}},Au=function(){return Du(function(n,t,e,r,o){return n()})},ku=function(i){return Du(function(n,t,e,r,o){return t(i)})},Ou=function(i,u){return Du(function(n,t,e,r,o){return e(i,u)})},Nu=function(i,u,a){return Du(function(n,t,e,r,o){return r(i,u,a)})},Eu=function(i,u){return Du(function(n,t,e,r,o){return o(i,u)})},Bu=function(n,t,i,u){var e,r,a=n.slice(0),o=(r=t,0===(e=n).length?Au():1===e.length?ku(0):0===r?Ou(0,1):r===e.length-1?Eu(r-1,r):0<r&&r<e.length-1?Nu(r-1,r,r+1):Au()),c=function(n){return B.map(n,y.constant(0))},l=y.constant(c(a)),s=function(n,t){if(0<=i){var e=Math.max(u.minCellWidth(),a[t]-i);return c(a.slice(0,n)).concat([i,e-a[t]]).concat(c(a.slice(t+1)))}var r=Math.max(u.minCellWidth(),a[n]+i),o=a[n]-r;return c(a.slice(0,n)).concat([r-a[n],o]).concat(c(a.slice(t+1)))},f=s;return o.fold(l,function(n){return u.singleColumnWidth(a[n],i)},f,function(n,t,e){return s(t,e)},function(n,t){if(0<=i)return c(a.slice(0,t)).concat([i]);var e=Math.max(u.minCellWidth(),a[t]+i);return c(a.slice(0,t)).concat([e-a[t]])})},Pu=function(n,t){return St.has(n,t)&&1<parseInt(St.get(n,t),10)},Iu={hasColspan:function(n){return Pu(n,"colspan")},hasRowspan:function(n){return Pu(n,"rowspan")},minWidth:y.constant(10),minHeight:y.constant(10),getInt:function(n,t){return parseInt(ie.get(n,t),10)}},Wu=function(n,t,e){return ie.getRaw(n,t).fold(function(){return e(n)+"px"},function(n){return n})},Mu=function(n){return Wu(n,"width",uo.getPixelWidth)},Lu=function(n){return Wu(n,"height",uo.getHeight)},qu=function(n,t,e,r,o){var i=pi(n),u=B.map(i,function(n){return n.map(t.edge)});return B.map(i,function(n,t){return n.filter(y.not(Iu.hasColspan)).fold(function(){var n=gi(u,t);return r(n)},function(n){return e(n,o)})})},ju=function(n){return n.map(function(n){return n+"px"}).getOr("")},_u=function(n,t,e,r){var o=vi(n),i=B.map(o,function(n){return n.map(t.edge)});return B.map(o,function(n,t){return n.filter(y.not(Iu.hasRowspan)).fold(function(){var n=gi(i,t);return r(n)},function(n){return e(n)})})},zu={getRawWidths:function(n,t){return qu(n,t,Mu,ju)},getPixelWidths:function(n,t,e){return qu(n,t,uo.getPixelWidth,function(n){return n.getOrThunk(e.minCellWidth)},e)},getPercentageWidths:function(n,t,e){return qu(n,t,uo.getPercentageWidth,function(n){return n.fold(function(){return e.minCellWidth()},function(n){return n/e.pixelWidth()*100})},e)},getPixelHeights:function(n,t){return _u(n,t,uo.getHeight,function(n){return n.getOrThunk(Iu.minHeight)})},getRawHeights:function(n,t){return _u(n,t,Lu,ju)}},Fu=function(n,t,e){for(var r=0,o=n;o<t;o++)r+=void 0!==e[o]?e[o]:0;return r},Hu=function(n,e){var t=Qt.justCells(n);return B.map(t,function(n){var t=Fu(n.column(),n.column()+n.colspan(),e);return{element:n.element,width:y.constant(t),colspan:n.colspan}})},Uu=function(n,e){var t=Qt.justCells(n);return B.map(t,function(n){var t=Fu(n.row(),n.row()+n.rowspan(),e);return{element:n.element,height:y.constant(t),rowspan:n.rowspan}})},Vu=function(n,e){return B.map(n.all(),function(n,t){return{element:n.element,height:y.constant(e[t])}})},Gu=function(n){var t=parseInt(n,10),e=y.identity;return{width:y.constant(t),pixelWidth:y.constant(t),getWidths:zu.getPixelWidths,getCellDelta:e,singleColumnWidth:function(n,t){return[Math.max(Iu.minWidth(),n+t)-n]},minCellWidth:Iu.minWidth,setElementWidth:uo.setPixelWidth,setTableWidth:function(n,t,e){var r=B.foldr(t,function(n,t){return n+t},0);uo.setPixelWidth(n,r)}}},Xu=function(n,t){if(uo.percentageBasedSizeRegex().test(t)){var e=uo.percentageBasedSizeRegex().exec(t);return o=e[1],i=n,u=parseFloat(o),a=Gr(i),{width:y.constant(u),pixelWidth:y.constant(a),getWidths:zu.getPercentageWidths,getCellDelta:function(n){return n/a*100},singleColumnWidth:function(n,t){return[100-n]},minCellWidth:function(){return Iu.minWidth()/a*100},setElementWidth:uo.setPercentageWidth,setTableWidth:function(n,t,e){var r=u+e;uo.setPercentageWidth(n,r)}}}if(uo.pixelBasedSizeRegex().test(t)){var r=uo.pixelBasedSizeRegex().exec(t);return Gu(r[1])}var o,i,u,a,c=Gr(n);return Gu(c)},Yu=function(t){return uo.getRawWidth(t).fold(function(){var n=Gr(t);return Gu(n)},function(n){return Xu(t,n)})},Ku=function(n){return Qt.generate(n)},$u=function(n){var t=Yt(n);return Ku(t)},Ju=function(n,t,e,r){var o=Yu(n),i=o.getCellDelta(t),u=$u(n),a=o.getWidths(u,r,o),c=Bu(a,e,i,o),l=B.map(c,function(n,t){return n+a[t]}),s=Hu(u,l);B.each(s,function(n){o.setElementWidth(n.element(),n.width())}),e===u.grid().columns()-1&&o.setTableWidth(n,l,i)},Qu=function(n,e,r,t){var o=$u(n),i=zu.getPixelHeights(o,t),u=B.map(i,function(n,t){return r===t?Math.max(e+n,Iu.minHeight()):n}),a=Uu(o,u),c=Vu(o,u);B.each(c,function(n){uo.setHeight(n.element(),n.height())}),B.each(a,function(n){uo.setHeight(n.element(),n.height())});var l,s=(l=u,B.foldr(l,function(n,t){return n+t},0));uo.setHeight(n,s)},Zu=function(n,t,e){var r=Yu(n),o=Ku(t),i=r.getWidths(o,e,r),u=Hu(o,i);B.each(u,function(n){r.setElementWidth(n.element(),n.width())});var a=B.foldr(i,function(n,t){return t+n},0);0<u.length&&r.setElementWidth(n,a)},na=function(n){0===Xt.cells(n).length&&fe.remove(n)},ta=V.immutable("grid","cursor"),ea=function(n,t,e){return ra(n,t,e).orThunk(function(){return ra(n,0,0)})},ra=function(n,t,e){return x.from(n[t]).bind(function(n){return x.from(n.cells()[e]).bind(function(n){return x.from(n.element())})})},oa=function(n,t,e){return ta(n,ra(n,t,e))},ia=function(n){return B.foldl(n,function(n,t){return B.exists(n,function(n){return n.row()===t.row()})?n:n.concat([t])},[]).sort(function(n,t){return n.row()-t.row()})},ua=function(n){return B.foldl(n,function(n,t){return B.exists(n,function(n){return n.column()===t.column()})?n:n.concat([t])},[]).sort(function(n,t){return n.column()-t.column()})},aa=function(n,t,e){var r=Kt(n,e),o=Qt.generate(r);return ci(o,t,!0)},ca=Zu,la={insertRowBefore:Xi(function(n,t,e,r){var o=t.row(),i=t.row(),u=hu(n,i,o,e,r.getOrInit);return oa(u,i,t.column())},Ki,y.noop,y.noop,Mo),insertRowsBefore:Xi(function(n,t,e,r){var o=t[0].row(),i=t[0].row(),u=ia(t),a=B.foldl(u,function(n,t){return hu(n,i,o,e,r.getOrInit)},n);return oa(a,i,t[0].column())},$i,y.noop,y.noop,Mo),insertRowAfter:Xi(function(n,t,e,r){var o=t.row(),i=t.row()+t.rowspan(),u=hu(n,i,o,e,r.getOrInit);return oa(u,i,t.column())},Ki,y.noop,y.noop,Mo),insertRowsAfter:Xi(function(n,t,e,r){var o=ia(t),i=o[o.length-1].row(),u=o[o.length-1].row()+o[o.length-1].rowspan(),a=B.foldl(o,function(n,t){return hu(n,u,i,e,r.getOrInit)},n);return oa(a,u,t[0].column())},$i,y.noop,y.noop,Mo),insertColumnBefore:Xi(function(n,t,e,r){var o=t.column(),i=t.column(),u=pu(n,i,o,e,r.getOrInit);return oa(u,t.row(),i)},Ki,ca,y.noop,Mo),insertColumnsBefore:Xi(function(n,t,e,r){var o=ua(t),i=o[0].column(),u=o[0].column(),a=B.foldl(o,function(n,t){return pu(n,u,i,e,r.getOrInit)},n);return oa(a,t[0].row(),u)},$i,ca,y.noop,Mo),insertColumnAfter:Xi(function(n,t,e,r){var o=t.column(),i=t.column()+t.colspan(),u=pu(n,i,o,e,r.getOrInit);return oa(u,t.row(),i)},Ki,ca,y.noop,Mo),insertColumnsAfter:Xi(function(n,t,e,r){var o=t[t.length-1].column(),i=t[t.length-1].column()+t[t.length-1].colspan(),u=ua(t),a=B.foldl(u,function(n,t){return pu(n,i,o,e,r.getOrInit)},n);return oa(a,t[0].row(),i)},$i,ca,y.noop,Mo),splitCellIntoColumns:Xi(function(n,t,e,r){var o=vu(n,t.row(),t.column(),e,r.getOrInit);return oa(o,t.row(),t.column())},Ki,ca,y.noop,Mo),splitCellIntoRows:Xi(function(n,t,e,r){var o=bu(n,t.row(),t.column(),e,r.getOrInit);return oa(o,t.row(),t.column())},Ki,y.noop,y.noop,Mo),eraseColumns:Xi(function(n,t,e,r){var o=ua(t),i=yu(n,o[0].column(),o[o.length-1].column()),u=ea(i,t[0].row(),t[0].column());return ta(i,u)},$i,ca,na,Mo),eraseRows:Xi(function(n,t,e,r){var o=ia(t),i=wu(n,o[0].row(),o[o.length-1].row()),u=ea(i,t[0].row(),t[0].column());return ta(i,u)},$i,y.noop,na,Mo),makeColumnHeader:Xi(function(n,t,e,r){var o=Ru(n,t.column(),e,r.replaceOrInit);return oa(o,t.row(),t.column())},Ki,y.noop,y.noop,Lo("row","th")),unmakeColumnHeader:Xi(function(n,t,e,r){var o=Ru(n,t.column(),e,r.replaceOrInit);return oa(o,t.row(),t.column())},Ki,y.noop,y.noop,Lo(null,"td")),makeRowHeader:Xi(function(n,t,e,r){var o=Tu(n,t.row(),e,r.replaceOrInit);return oa(o,t.row(),t.column())},Ki,y.noop,y.noop,Lo("col","th")),unmakeRowHeader:Xi(function(n,t,e,r){var o=Tu(n,t.row(),e,r.replaceOrInit);return oa(o,t.row(),t.column())},Ki,y.noop,y.noop,Lo(null,"td")),mergeCells:Xi(function(n,t,e,r){var o=t.cells();Ko(o);var i=su(n,t.bounds(),e,y.constant(o[0]));return ta(i,x.from(o[0]))},Zi,y.noop,y.noop,qo),unmergeCells:Xi(function(n,t,e,r){var o=B.foldr(t,function(n,t){return fu(n,t,e,r.combine(t))},n);return ta(o,x.from(t[0]))},nu,ca,y.noop,qo),pasteCells:Xi(function(n,e,t,r){var o,i,u,a,c=(o=e.clipboard(),i=e.generators(),u=Yt(o),a=Qt.generate(u),ci(a,i,!0)),l=Q.address(e.row(),e.column());return mu(l,n,c,e.generators(),t).fold(function(){return ta(n,x.some(e.element()))},function(n){var t=ea(n,e.row(),e.column());return ta(n,t)})},Ji,ca,y.noop,Mo),pasteRowsBefore:Xi(function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[0].row(),u=aa(t.clipboard(),t.generators(),o),a=gu(i,n,u,t.generators(),e),c=ea(a,t.cells[0].row(),t.cells[0].column());return ta(a,c)},Qi,y.noop,y.noop,Mo),pasteRowsAfter:Xi(function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[t.cells.length-1].row()+t.cells[t.cells.length-1].rowspan(),u=aa(t.clipboard(),t.generators(),o),a=gu(i,n,u,t.generators(),e),c=ea(a,t.cells[0].row(),t.cells[0].column());return ta(a,c)},Qi,y.noop,y.noop,Mo)},sa=function(n){return nn.fromDom(n.getBody())},fa=function(n){return n.getBoundingClientRect().width},da=function(n){return n.getBoundingClientRect().height},ma=function(t){return function(n){return tt.eq(n,sa(t))}},ga=function(n){return/^[0-9]+$/.test(n)&&(n+="px"),n},ha=function(n){var t=Ot.descendants(n,"td[data-mce-style],th[data-mce-style]");St.remove(n,"data-mce-style"),B.each(t,function(n){St.remove(n,"data-mce-style")})},pa=function(n){return"rtl"===ie.get(n,"direction")?"rtl":"ltr"},va={onDirection:function(t,e){return function(n){return"rtl"===pa(n)?e:t}},getDirection:pa},ba={isRtl:y.constant(!1)},wa={isRtl:y.constant(!0)},ya={directionAt:function(n){return"rtl"===va.getDirection(n)?wa:ba}},xa=["tableprops","tabledelete","|","tableinsertrowbefore","tableinsertrowafter","tabledeleterow","|","tableinsertcolbefore","tableinsertcolafter","tabledeletecol"],Ca={"border-collapse":"collapse",width:"100%"},Sa={border:"1"},Ra=function(n){return n.getParam("table_cell_advtab",!0,"boolean")},Ta=function(n){return n.getParam("table_row_advtab",!0,"boolean")},Da=function(n){return n.getParam("table_advtab",!0,"boolean")},Aa=function(n){return n.getParam("table_style_by_css",!1,"boolean")},ka=function(n){return n.getParam("table_cell_class_list",[],"array")},Oa=function(n){return n.getParam("table_row_class_list",[],"array")},Na=function(n){return n.getParam("table_class_list",[],"array")},Ea=function(n){return!1===n.getParam("table_responsive_width")},Ba=function(n,t){return n.fire("newrow",{node:t})},Pa=function(n,t){return n.fire("newcell",{node:t})},Ia=function(n,t,e,r){n.fire("ObjectResizeStart",{target:t,width:e,height:r})},Wa=function(n,t,e,r){n.fire("ObjectResized",{target:t,width:e,height:r})},Ma=function(s,n){var t,e=function(n){return"table"===bt.name(sa(n))},f=(t=s.getParam("table_clone_elements"),p.isString(t)?x.some(t.split(/[ ,]/)):Array.isArray(t)?x.some(t):x.none()),r=function(u,a,c,l){return function(n,t){ha(n);var e=l(),r=nn.fromDom(s.getDoc()),o=Ao(ya.directionAt),i=Be(c,r,f);return a(n)?u(e,n,t,i,o).bind(function(n){return B.each(n.newRows(),function(n){Ba(s,n.dom())}),B.each(n.newCells(),function(n){Pa(s,n.dom())}),n.cursor().map(function(n){var t=s.dom.createRng();return t.setStart(n.dom(),0),t.setEnd(n.dom(),0),t})}):x.none()}};return{deleteRow:r(la.eraseRows,function(n){var t=ko(n);return!1===e(s)||1<t.rows()},y.noop,n),deleteColumn:r(la.eraseColumns,function(n){var t=ko(n);return!1===e(s)||1<t.columns()},y.noop,n),insertRowsBefore:r(la.insertRowsBefore,y.always,y.noop,n),insertRowsAfter:r(la.insertRowsAfter,y.always,y.noop,n),insertColumnsBefore:r(la.insertColumnsBefore,y.always,ao,n),insertColumnsAfter:r(la.insertColumnsAfter,y.always,ao,n),mergeCells:r(la.mergeCells,y.always,y.noop,n),unmergeCells:r(la.unmergeCells,y.always,y.noop,n),pasteRowsBefore:r(la.pasteRowsBefore,y.always,y.noop,n),pasteRowsAfter:r(la.pasteRowsAfter,y.always,y.noop,n),pasteCells:r(la.pasteCells,y.always,y.noop,n)}},La=function(n,t,r){var e=Yt(n),o=Qt.generate(e);return $i(o,t).map(function(n){var t=ci(o,r,!1).slice(n[0].row(),n[n.length-1].row()+n[n.length-1].rowspan()),e=Yi(t,r);return fi(e)})},qa=tinymce.util.Tools.resolve("tinymce.util.Tools"),ja=function(n,t,e){e&&n.formatter.apply("align"+e,{},t)},_a=function(n,t,e){e&&n.formatter.apply("valign"+e,{},t)},za=function(t,e){qa.each("left center right".split(" "),function(n){t.formatter.remove("align"+n,{},e)})},Fa=function(t,e){qa.each("top middle bottom".split(" "),function(n){t.formatter.remove("valign"+n,{},e)})},Ha=function(o,n,i){var t;return t=function(n,t){for(var e=0;e<t.length;e++){var r=o.getStyle(t[e],i);if(void 0===n&&(n=r),n!==r)return""}return n}(t,o.select("td,th",n))},Ua=function(n,t){var e=n.dom,r=t.control.rootControl,o=r.toJSON(),i=e.parseStyle(o.style);"style"===t.control.name()?(r.find("#borderStyle").value(i["border-style"]||"")[0].fire("select"),r.find("#borderColor").value(i["border-color"]||"")[0].fire("change"),r.find("#backgroundColor").value(i["background-color"]||"")[0].fire("change"),r.find("#width").value(i.width||"").fire("change"),r.find("#height").value(i.height||"").fire("change")):(i["border-style"]=o.borderStyle,i["border-color"]=o.borderColor,i["background-color"]=o.backgroundColor,i.width=o.width?ga(o.width):"",i.height=o.height?ga(o.height):""),r.find("#style").value(e.serializeStyle(e.parseStyle(e.serializeStyle(i))))},Va=function(e){return{title:"Advanced",type:"form",defaults:{onchange:y.curry(Ua,e)},items:[{label:"",name:"style",type:"spacer"},{type:"form",padding:0,formItemDefaults:{layout:"grid",alignH:["start","right"]},defaults:{size:7},items:[{label:"Border style",type:"listbox",name:"borderStyle",width:90,onselect:y.curry(Ua,e),values:[{text:"Solid",value:"solid"}]},{label:"Background color",type:"colorbox",name:"backgroundColor",onaction:function(){var n=e.getParam("color_picker_callback");if(n)return function(t){return n.call(e,function(n){t.control.value(n).fire("change")},t.control.value())}}()}]}]}},Ga=function(n,r,t){var o=function(n,e){return e=e||[],qa.each(n,function(n){var t={text:n.text||n.title};n.menu?t.menu=o(n.menu):(t.value=n.value,r&&r(t)),e.push(t)}),e};return o(n,t||[])},Xa=Ua,Ya=function(n,t){var e=n.parseStyle(n.getAttrib(t,"style")),r={};return e["border-style"]&&(r.borderStyle=e["border-style"]),e["border-color"]&&(r.borderColor=e["border-color"]),e["background-color"]&&(r.backgroundColor=e["background-color"]),r.style=n.serializeStyle(e),r},Ka=function(r,o,n){var i,u=r.dom;function a(n,t,e){e&&u.setAttrib(n,t,e)}function c(n,t,e){e&&u.setStyle(n,t,e)}Xa(r,n),i=n.control.rootControl.toJSON(),r.undoManager.transact(function(){qa.each(o,function(n){var t,e;a(n,"scope",i.scope),1===o.length?a(n,"style",i.style):(t=n,e=i.style,delete t.dataset.mceStyle,t.style.cssText+=";"+e),a(n,"class",i.class),c(n,"width",ga(i.width)),c(n,"height",ga(i.height)),i.type&&n.nodeName.toLowerCase()!==i.type&&(n=u.rename(n,i.type)),1===o.length&&(za(r,n),Fa(r,n)),i.align&&ja(r,n,i.align),i.valign&&_a(r,n,i.valign)}),r.focus()})},$a=function(t){var n,e,r,o=[];if(o=t.dom.select("td[data-mce-selected],th[data-mce-selected]"),n=t.dom.getParent(t.selection.getStart(),"td,th"),!o.length&&n&&o.push(n),n=n||o[0]){var i,u,a,c;1<o.length?e={width:"",height:"",scope:"",class:"",align:"",valign:"",style:"",type:n.nodeName.toLowerCase()}:(u=n,a=(i=t).dom,c={width:a.getStyle(u,"width")||a.getAttrib(u,"width"),height:a.getStyle(u,"height")||a.getAttrib(u,"height"),scope:a.getAttrib(u,"scope"),class:a.getAttrib(u,"class"),type:u.nodeName.toLowerCase(),style:"",align:"",valign:""},qa.each("left center right".split(" "),function(n){i.formatter.matchNode(u,"align"+n)&&(c.align=n)}),qa.each("top middle bottom".split(" "),function(n){i.formatter.matchNode(u,"valign"+n)&&(c.valign=n)}),Ra(i)&&qa.extend(c,Ya(a,u)),e=c),0<ka(t).length&&(r={name:"class",type:"listbox",label:"Class",values:Ga(ka(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"td",classes:[n.value]})})})});var l={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",layout:"grid",columns:2,labelGapCalc:!1,padding:0,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width",onchange:y.curry(Xa,t)},{label:"H Align",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"V Align",name:"valign",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}]},r]};Ra(t)?t.windowManager.open({title:"Cell properties",bodyType:"tabpanel",data:e,body:[{title:"General",type:"form",items:l},Va(t)],onsubmit:y.curry(Ka,t,o)}):t.windowManager.open({title:"Cell properties",data:e,body:l,onsubmit:y.curry(Ka,t,o)})}};function Ja(s,n,f,t){var d=s.dom;function m(n,t,e){e&&d.setAttrib(n,t,e)}Xa(s,t);var g=t.control.rootControl.toJSON();s.undoManager.transact(function(){qa.each(n,function(n){var t,e,r,o,i,u,a,c,l;m(n,"scope",g.scope),m(n,"style",g.style),m(n,"class",g.class),t=n,e="height",(r=ga(g.height))&&d.setStyle(t,e,r),g.type!==n.parentNode.nodeName.toLowerCase()&&(o=s.dom,i=n,u=g.type,a=o.getParent(i,"table"),c=i.parentNode,(l=o.select(u,a)[0])||(l=o.create(u),a.firstChild?"CAPTION"===a.firstChild.nodeName?o.insertAfter(l,a.firstChild):a.insertBefore(l,a.firstChild):a.appendChild(l)),l.appendChild(i),c.hasChildNodes()||o.remove(c)),g.align!==f.align&&(za(s,n),ja(s,n,g.align))}),s.focus()})}var Qa=function(t){var n,e,r,o,i,u,a,c,l,s,f=t.dom,d=[];n=f.getParent(t.selection.getStart(),"table"),e=f.getParent(t.selection.getStart(),"td,th"),qa.each(n.rows,function(t){qa.each(t.cells,function(n){if(f.getAttrib(n,"data-mce-selected")||n===e)return d.push(t),!1})}),(r=d[0])&&(1<d.length?i={height:"",scope:"",style:"",class:"",align:"",type:r.parentNode.nodeName.toLowerCase()}:(c=r,l=(a=t).dom,s={height:l.getStyle(c,"height")||l.getAttrib(c,"height"),scope:l.getAttrib(c,"scope"),class:l.getAttrib(c,"class"),align:"",style:"",type:c.parentNode.nodeName.toLowerCase()},qa.each("left center right".split(" "),function(n){a.formatter.matchNode(c,"align"+n)&&(s.align=n)}),Ta(a)&&qa.extend(s,Ya(l,c)),i=s),0<Oa(t).length&&(o={name:"class",type:"listbox",label:"Class",values:Ga(Oa(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"tr",classes:[n.value]})})})}),u={type:"form",columns:2,padding:0,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"Header",maxWidth:null,values:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"},o]},Ta(t)?t.windowManager.open({title:"Row properties",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:u},Va(t)],onsubmit:y.curry(Ja,t,d,i)}):t.windowManager.open({title:"Row properties",data:i,body:u,onsubmit:y.curry(Ja,t,d,i)}))},Za=tinymce.util.Tools.resolve("tinymce.Env"),nc={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},tc=function(n,t,e,r,o){void 0===o&&(o=nc);var i=nn.fromTag("table");ie.setAll(i,o.styles),St.setAll(i,o.attributes);var u=nn.fromTag("tbody");ce.append(i,u);for(var a=[],c=0;c<n;c++){for(var l=nn.fromTag("tr"),s=0;s<t;s++){var f=c<e||s<r?nn.fromTag("th"):nn.fromTag("td");s<r&&St.set(f,"scope","row"),c<e&&St.set(f,"scope","col"),ce.append(f,nn.fromTag("br")),o.percentages&&ie.set(f,"width",100/t+"%"),ce.append(l,f)}a.push(l)}return le.append(u,a),i},ec=function(n){return n.dom().innerHTML},rc=function(n){var t=nn.fromTag("div"),e=nn.fromDom(n.dom().cloneNode(!0));return ce.append(t,e),ec(t)},oc=function(n,t){n.selection.select(t.dom(),!0),n.selection.collapse(!0)},ic=function(i,n,t){var e,r,o=i.getParam("table_default_styles",Ca,"object"),u={styles:o,attributes:(r=i,r.getParam("table_default_attributes",Sa,"object")),percentages:(e=o.width,p.isString(e)&&-1!==e.indexOf("%")&&!Ea(i))},a=tc(t,n,0,0,u);St.set(a,"data-mce-id","__mce");var c=rc(a);return i.insertContent(c),zt.descendant(sa(i),'table[data-mce-id="__mce"]').map(function(n){var t,e,r,o;return Ea(i)&&ie.set(n,"width",ie.get(n,"width")),St.remove(n,"data-mce-id"),t=i,e=n,B.each(Ot.descendants(e,"tr"),function(n){Ba(t,n.dom()),B.each(Ot.descendants(n,"th,td"),function(n){Pa(t,n.dom())})}),r=i,o=n,zt.descendant(o,"td,th").each(y.curry(oc,r)),n.dom()}).getOr(null)};function uc(n,t,e,r){if("TD"===t.tagName||"TH"===t.tagName)n.setStyle(t,e,r);else if(t.children)for(var o=0;o<t.children.length;o++)uc(n,t.children[o],e,r)}var ac=function(n,t,e){var r,o,i=n.dom;Xa(n,e),!1===(o=e.control.rootControl.toJSON()).class&&delete o.class,n.undoManager.transact(function(){t||(t=ic(n,o.cols||1,o.rows||1)),function(n,t,e){var r,o=n.dom,i={},u={};if(i.class=e.class,u.height=ga(e.height),o.getAttrib(t,"width")&&!Aa(n)?i.width=(r=e.width)?r.replace(/px$/,""):"":u.width=ga(e.width),Aa(n)?(u["border-width"]=ga(e.border),u["border-spacing"]=ga(e.cellspacing),qa.extend(i,{"data-mce-border-color":e.borderColor,"data-mce-cell-padding":e.cellpadding,"data-mce-border":e.border})):qa.extend(i,{border:e.border,cellpadding:e.cellpadding,cellspacing:e.cellspacing}),Aa(n)&&t.children)for(var a=0;a<t.children.length;a++)uc(o,t.children[a],{"border-width":ga(e.border),"border-color":e.borderColor,padding:ga(e.cellpadding)});e.style?qa.extend(u,o.parseStyle(e.style)):u=qa.extend({},o.parseStyle(o.getAttrib(t,"style")),u),i.style=o.serializeStyle(u),o.setAttribs(t,i)}(n,t,o),(r=i.select("caption",t)[0])&&!o.caption&&i.remove(r),!r&&o.caption&&((r=i.create("caption")).innerHTML=Za.ie?"Â ":'<br data-mce-bogus="1"/>',t.insertBefore(r,t.firstChild)),za(n,t),o.align&&ja(n,t,o.align),n.focus(),n.addVisual()})},cc=function(t,n){var e,r,o,i,u,a,c,l,s,f,d=t.dom,m={};!0===n?(e=d.getParent(t.selection.getStart(),"table"))&&(c=e,l=(a=t).dom,s={width:l.getStyle(c,"width")||l.getAttrib(c,"width"),height:l.getStyle(c,"height")||l.getAttrib(c,"height"),cellspacing:l.getStyle(c,"border-spacing")||l.getAttrib(c,"cellspacing"),cellpadding:l.getAttrib(c,"data-mce-cell-padding")||l.getAttrib(c,"cellpadding")||Ha(a.dom,c,"padding"),border:l.getAttrib(c,"data-mce-border")||l.getAttrib(c,"border")||Ha(a.dom,c,"border"),borderColor:l.getAttrib(c,"data-mce-border-color"),caption:!!l.select("caption",c)[0],class:l.getAttrib(c,"class")},qa.each("left center right".split(" "),function(n){a.formatter.matchNode(c,"align"+n)&&(s.align=n)}),Da(a)&&qa.extend(s,Ya(l,c)),m=s):(r={label:"Cols",name:"cols"},o={label:"Rows",name:"rows"}),0<Na(t).length&&(m.class&&(m.class=m.class.replace(/\s*mce\-item\-table\s*/g,"")),i={name:"class",type:"listbox",label:"Class",values:Ga(Na(t),function(n){n.value&&(n.textStyle=function(){return t.formatter.getCssText({block:"table",classes:[n.value]})})})}),u={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",labelGapCalc:!1,padding:0,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:(f=t,f.getParam("table_appearance_options",!0,"boolean")?[r,o,{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"}]:[r,o,{label:"Width",name:"width",onchange:y.curry(Xa,t)},{label:"Height",name:"height",onchange:y.curry(Xa,t)}])},i]},Da(t)?t.windowManager.open({title:"Table properties",data:m,bodyType:"tabpanel",body:[{title:"General",type:"form",items:u},Va(t)],onsubmit:y.curry(ac,t,e)}):t.windowManager.open({title:"Table properties",data:m,body:u,onsubmit:y.curry(ac,t,e)})},lc=qa.each,sc=function(a,t,c,l,e){var r=ma(a),s=function(){return nn.fromDom(a.dom.getParent(a.selection.getStart(),"th,td"))},f=function(n){return Xt.table(n,r)},d=function(n){return{width:fa(n.dom()),height:fa(n.dom())}},o=function(t){var e=s();f(e).each(function(i){var n=jr.forMenu(l,i,e),u=d(i);t(i,n).each(function(n){var t,e,r,o;t=a,e=u,o=d(r=i),e.width===o.width&&e.height===o.height||(Ia(t,r.dom(),e.width,e.height),Wa(t,r.dom(),o.width,o.height)),a.selection.setRng(n),a.focus(),c.clear(i),ha(i)})})},i=function(n){var o=s();return f(o).bind(function(n){var t=nn.fromDom(a.getDoc()),e=jr.forMenu(l,n,o),r=Be(y.noop,t,x.none());return La(n,e,r)})},u=function(u){e.get().each(function(n){var o=B.map(n,function(n){return be(n)}),i=s();f(i).bind(function(t){var n=nn.fromDom(a.getDoc()),e=Pe(n),r=jr.pasteRows(l,t,i,o,e);u(t,r).each(function(n){a.selection.setRng(n),a.focus(),c.clear(t)})})})};lc({mceTableSplitCells:function(){o(t.unmergeCells)},mceTableMergeCells:function(){o(t.mergeCells)},mceTableInsertRowBefore:function(){o(t.insertRowsBefore)},mceTableInsertRowAfter:function(){o(t.insertRowsAfter)},mceTableInsertColBefore:function(){o(t.insertColumnsBefore)},mceTableInsertColAfter:function(){o(t.insertColumnsAfter)},mceTableDeleteCol:function(){o(t.deleteColumn)},mceTableDeleteRow:function(){o(t.deleteRow)},mceTableCutRow:function(n){e.set(i()),o(t.deleteRow)},mceTableCopyRow:function(n){e.set(i())},mceTablePasteRowBefore:function(n){u(t.pasteRowsBefore)},mceTablePasteRowAfter:function(n){u(t.pasteRowsAfter)},mceTableDelete:function(){var n=nn.fromDom(a.dom.getParent(a.selection.getStart(),"th,td"));Xt.table(n,r).filter(y.not(r)).each(function(n){var t=nn.fromText("");ce.after(n,t),fe.remove(n);var e=a.dom.createRng();e.setStart(t.dom(),0),e.setEnd(t.dom(),0),a.selection.setRng(e)})}},function(n,t){a.addCommand(t,n)}),lc({mceInsertTable:y.curry(cc,a),mceTableProps:y.curry(cc,a,!0),mceTableRowProps:y.curry(Qa,a),mceTableCellProps:y.curry($a,a)},function(e,n){a.addCommand(n,function(n,t){e(t)})})},fc=function(n){var t=x.from(n.dom().documentElement).map(nn.fromDom).getOr(n);return{parent:y.constant(t),view:y.constant(n),origin:y.constant(so(0,0))}},dc=function(n,t){return{parent:y.constant(t),view:y.constant(n),origin:y.constant(so(0,0))}};function mc(n){var e=V.immutable.apply(null,n),r=[];return{bind:function(n){if(void 0===n)throw"Event bind error: undefined handler";r.push(n)},unbind:function(t){r=B.filter(r,function(n){return n!==t})},trigger:function(){var t=e.apply(null,arguments);B.each(r,function(n){n(t)})}}}var gc={create:function(n){return{registry:q.map(n,function(n){return{bind:n.bind,unbind:n.unbind}}),trigger:q.map(n,function(n){return n.trigger})}}},hc={mode:Po.exactly(["compare","extract","mutate","sink"]),sink:Po.exactly(["element","start","stop","destroy"]),api:Po.exactly(["forceDrop","drop","move","delayDrop"])},pc={resolve:yi("ephox-dragster").resolve},vc=function(m,g){return function(n){if(m(n)){var t,e,r,o,i,u,a,c=nn.fromDom(n.target),l=function(){n.stopPropagation()},s=function(){n.preventDefault()},f=y.compose(s,l),d=(t=c,e=n.clientX,r=n.clientY,o=l,i=s,u=f,a=n,{target:y.constant(t),x:y.constant(e),y:y.constant(r),stop:o,prevent:i,kill:u,raw:y.constant(a)});g(d)}}},bc=function(n,t,e,r,o){var i=vc(e,r);return n.dom().addEventListener(t,i,o),{unbind:y.curry(wc,n,t,i,o)}},wc=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},yc=function(n,t,e,r){return bc(n,t,e,r,!1)},xc=function(n,t,e,r){return bc(n,t,e,r,!0)},Cc=y.constant(!0),Sc={bind:function(n,t,e){return yc(n,t,Cc,e)},capture:function(n,t,e){return xc(n,t,Cc,e)}},Rc=hc.mode({compare:function(n,t){return so(t.left()-n.left(),t.top()-n.top())},extract:function(n){return x.some(so(n.x(),n.y()))},sink:function(n,t){var e,r,o,i=(e=t,r=Zo.merge({layerClass:pc.resolve("blocker")},e),o=nn.fromTag("div"),St.set(o,"role","presentation"),ie.setAll(o,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),Wi.add(o,pc.resolve("blocker")),Wi.add(o,r.layerClass),{element:function(){return o},destroy:function(){fe.remove(o)}}),u=Sc.bind(i.element(),"mousedown",n.forceDrop),a=Sc.bind(i.element(),"mouseup",n.drop),c=Sc.bind(i.element(),"mousemove",n.move),l=Sc.bind(i.element(),"mouseout",n.delayDrop);return hc.sink({element:i.element,start:function(n){ce.append(n,i.element())},stop:function(){fe.remove(i.element())},destroy:function(){i.destroy(),a.unbind(),c.unbind(),l.unbind(),u.unbind()}})},mutate:function(n,t){n.mutate(t.left(),t.top())}});function Tc(){var i=x.none(),u=gc.create({move:mc(["info"])});return{onEvent:function(n,o){o.extract(n).each(function(n){var t,e,r;(t=o,e=n,r=i.map(function(n){return t.compare(n,e)}),i=x.some(e),r).each(function(n){u.trigger.move(n)})})},reset:function(){i=x.none()},events:u.registry}}function Dc(){var n={onEvent:function(n,t){},reset:y.noop},t=Tc(),e=n;return{on:function(){e.reset(),e=t},off:function(){e.reset(),e=n},isOn:function(){return e===t},onEvent:function(n,t){e.onEvent(n,t)},events:t.events}}var Ac=function(t,e){var r=null;return{cancel:function(){null!==r&&(clearTimeout(r),r=null)},throttle:function(){var n=arguments;null!==r&&clearTimeout(r),r=setTimeout(function(){t.apply(null,n),n=r=null},e)}}},kc=function(t,e,n){var r=!1,o=gc.create({start:mc([]),stop:mc([])}),i=Dc(),u=function(){l.stop(),i.isOn()&&(i.off(),o.trigger.stop())},a=Ac(u,200);i.events.move.bind(function(n){e.mutate(t,n.info())});var c=function(t){return function(){var n=Array.prototype.slice.call(arguments,0);if(r)return t.apply(null,n)}},l=e.sink(hc.api({forceDrop:u,drop:c(u),move:c(function(n,t){a.cancel(),i.onEvent(n,e)}),delayDrop:c(a.throttle)}),n);return{element:l.element,go:function(n){l.start(n),i.on(),o.trigger.start()},on:function(){r=!0},off:function(){r=!1},destroy:function(){l.destroy()},events:o.registry}},Oc={transform:function(n,t){var e=void 0!==t?t:{},r=void 0!==e.mode?e.mode:Rc;return kc(n,r,t)}};function Nc(){var e,r=gc.create({drag:mc(["xDelta","yDelta","target"])}),o=x.none(),n={mutate:function(n,t){e.trigger.drag(n,t)},events:(e=gc.create({drag:mc(["xDelta","yDelta"])})).registry};return n.events.drag.bind(function(t){o.each(function(n){r.trigger.drag(t.xDelta(),t.yDelta(),n)})}),{assign:function(n){o=x.some(n)},get:function(){return o},mutate:n.mutate,events:r.registry}}var Ec={any:function(n){return zt.first(n).isSome()},ancestor:function(n,t,e){return zt.ancestor(n,t,e).isSome()},sibling:function(n,t){return zt.sibling(n,t).isSome()},child:function(n,t){return zt.child(n,t).isSome()},descendant:function(n,t){return zt.descendant(n,t).isSome()},closest:function(n,t,e){return zt.closest(n,t,e).isSome()}},Bc=xi.resolve("resizer-bar-dragging");function Pc(n,e){var r=To.height,t=function(o,t,i){var e=Nc(),r=Oc.transform(e,{}),u=x.none(),n=function(n,t){return x.from(St.get(n,t))};e.events.drag.bind(function(e){n(e.target(),"data-row").each(function(n){var t=Iu.getInt(e.target(),"top");ie.set(e.target(),"top",t+e.yDelta()+"px")}),n(e.target(),"data-column").each(function(n){var t=Iu.getInt(e.target(),"left");ie.set(e.target(),"left",t+e.xDelta()+"px")})});var a=function(n,t){return Iu.getInt(n,t)-parseInt(St.get(n,"data-initial-"+t),10)};r.events.stop.bind(function(){e.get().each(function(r){u.each(function(e){n(r,"data-row").each(function(n){var t=a(r,"top");St.remove(r,"data-initial-top"),d.trigger.adjustHeight(e,t,parseInt(n,10))}),n(r,"data-column").each(function(n){var t=a(r,"left");St.remove(r,"data-initial-left"),d.trigger.adjustWidth(e,t,parseInt(n,10))}),Hi.refresh(o,e,i,t)})})});var c=function(n,t){d.trigger.startAdjust(),e.assign(n),St.set(n,"data-initial-"+t,parseInt(ie.get(n,t),10)),Wi.add(n,Bc),ie.set(n,"opacity","0.2"),r.go(o.parent())},l=Sc.bind(o.parent(),"mousedown",function(n){Hi.isRowBar(n.target())&&c(n.target(),"top"),Hi.isColBar(n.target())&&c(n.target(),"left")}),s=function(n){return tt.eq(n,o.view())},f=Sc.bind(o.view(),"mouseover",function(n){"table"===bt.name(n.target())||Ec.closest(n.target(),"table",s)?(u="table"===bt.name(n.target())?x.some(n.target()):zt.ancestor(n.target(),"table",s)).each(function(n){Hi.refresh(o,n,i,t)}):Dt.inBody(n.target())&&Hi.destroy(o)}),d=gc.create({adjustHeight:mc(["table","delta","row"]),adjustWidth:mc(["table","delta","column"]),startAdjust:mc([])});return{destroy:function(){l.unbind(),f.unbind(),r.destroy(),Hi.destroy(o)},refresh:function(n){Hi.refresh(o,n,i,t)},on:r.on,off:r.off,hideBars:y.curry(Hi.hide,o),showBars:y.curry(Hi.show,o),events:d.registry}}(n,e,r),o=gc.create({beforeResize:mc(["table"]),afterResize:mc(["table"]),startDrag:mc([])});return t.events.adjustHeight.bind(function(n){o.trigger.beforeResize(n.table());var t=r.delta(n.delta(),n.table());Qu(n.table(),t,n.row(),r),o.trigger.afterResize(n.table())}),t.events.startAdjust.bind(function(n){o.trigger.startDrag()}),t.events.adjustWidth.bind(function(n){o.trigger.beforeResize(n.table());var t=e.delta(n.delta(),n.table());Ju(n.table(),t,n.column(),e),o.trigger.afterResize(n.table())}),{on:t.on,off:t.off,hideBars:t.hideBars,showBars:t.showBars,destroy:t.destroy,events:o.registry}}var Ic=function(n,t){return n.inline?dc(sa(n),(e=nn.fromTag("div"),ie.setAll(e,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),ce.append(Dt.body(),e),e)):fc(nn.fromDom(n.getDoc()));var e},Wc=function(n,t){n.inline&&fe.remove(t.parent())},Mc=function(u){var a,c,o=x.none(),i=x.none(),l=x.none(),s=/(\d+(\.\d+)?)%/,f=function(n){return"TABLE"===n.nodeName};return u.on("init",function(){var n,t=Ao(ya.directionAt),e=Ic(u);if(l=x.some(e),("table"===(n=u.getParam("object_resizing",!0))||n)&&u.getParam("table_resize_bars",!0,"boolean")){var r=Pc(e,t);r.on(),r.events.startDrag.bind(function(n){o=x.some(u.selection.getRng())}),r.events.beforeResize.bind(function(n){var t=n.table().dom();Ia(u,t,fa(t),da(t))}),r.events.afterResize.bind(function(n){var t=n.table(),e=t.dom();ha(t),o.each(function(n){u.selection.setRng(n),u.focus()}),Wa(u,e,fa(e),da(e)),u.undoManager.add()}),i=x.some(r)}}),u.on("ObjectResizeStart",function(n){var t,e=n.target;f(e)&&(a=n.width,t=e,c=u.dom.getStyle(t,"width")||u.dom.getAttrib(t,"width"))}),u.on("ObjectResized",function(n){var t=n.target;if(f(t)){var e=t;if(s.test(c)){var r=parseFloat(s.exec(c)[1]),o=n.width*r/a;u.dom.setStyle(e,"width",o+"%")}else{var i=[];qa.each(e.rows,function(n){qa.each(n.cells,function(n){var t=u.dom.getStyle(n,"width",!0);i.push({cell:n,width:t})})}),qa.each(i,function(n){u.dom.setStyle(n.cell,"width",n.width),u.dom.setAttrib(n.cell,"width",null)})}}}),{lazyResize:function(){return i},lazyWire:function(){return l.getOr(fc(nn.fromDom(u.getBody())))},destroy:function(){i.each(function(n){n.destroy()}),l.each(function(n){Wc(u,n)})}}},Lc=function(n){return{fold:n}},qc=function(o){return Lc(function(n,t,e,r){return n(o)})},jc=function(o){return Lc(function(n,t,e,r){return t(o)})},_c=function(o,i){return Lc(function(n,t,e,r){return e(o,i)})},zc=function(o){return Lc(function(n,t,e,r){return r(o)})},Fc=function(e,n){return Xt.table(e,n).bind(function(n){var t=Xt.cells(n);return B.findIndex(t,function(n){return tt.eq(e,n)}).map(function(n){return{index:y.constant(n),all:y.constant(t)}})})},Hc=function(t,n){return Fc(t,n).fold(function(){return qc(t)},function(n){return n.index()+1<n.all().length?_c(t,n.all()[n.index()+1]):zc(t)})},Uc=function(t,n){return Fc(t,n).fold(function(){return qc()},function(n){return 0<=n.index()-1?_c(t,n.all()[n.index()-1]):jc(t)})},Vc=Nr([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Gc={before:Vc.before,on:Vc.on,after:Vc.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(y.identity,y.identity,y.identity)}},Xc=Nr([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Yc=V.immutable("start","soffset","finish","foffset"),Kc={domRange:Xc.domRange,relative:Xc.relative,exact:Xc.exact,exactFromRange:function(n){return Xc.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:Yc,getWin:function(n){var t=n.match({domRange:function(n){return nn.fromDom(n.startContainer)},relative:function(n,t){return Gc.getStart(n)},exact:function(n,t,e,r){return n}});return lt.defaultView(t)}},$c=function(n,t,e,r){var o=lt.owner(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o},Jc=function(n,t,e,r){var o=$c(n,t,e,r),i=tt.eq(n,e)&&t===r;return o.collapsed&&!i},Qc=function(n,t){n.selectNodeContents(t.dom())},Zc=function(n){n.deleteContents()},nl=function(n){return{left:y.constant(n.left),top:y.constant(n.top),right:y.constant(n.right),bottom:y.constant(n.bottom),width:y.constant(n.width),height:y.constant(n.height)}},tl={create:function(n){return n.document.createRange()},replaceWith:function(n,t){Zc(n),n.insertNode(t.dom())},selectNodeContents:function(n,t){var e=n.document.createRange();return Qc(e,t),e},selectNodeContentsUsing:Qc,relativeToNative:function(n,t,e){var r,o,i=n.document.createRange();return r=i,t.fold(function(n){r.setStartBefore(n.dom())},function(n,t){r.setStart(n.dom(),t)},function(n){r.setStartAfter(n.dom())}),o=i,e.fold(function(n){o.setEndBefore(n.dom())},function(n,t){o.setEnd(n.dom(),t)},function(n){o.setEndAfter(n.dom())}),i},exactToNative:function(n,t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},deleteContents:Zc,cloneFragment:function(n){var t=n.cloneContents();return nn.fromDom(t)},getFirstRect:function(n){var t=n.getClientRects(),e=0<t.length?t[0]:n.getBoundingClientRect();return 0<e.width||0<e.height?x.some(e).map(nl):x.none()},getBounds:function(n){var t=n.getBoundingClientRect();return 0<t.width||0<t.height?x.some(t).map(nl):x.none()},isWithin:function(n,t){return t.compareBoundaryPoints(n.END_TO_START,n)<1&&-1<t.compareBoundaryPoints(n.START_TO_END,n)},toString:function(n){return n.toString()}},el=Nr([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),rl=function(n,t,e){return t(nn.fromDom(e.startContainer),e.startOffset,nn.fromDom(e.endContainer),e.endOffset)},ol=function(n,t){var o,e,r,i=(o=n,t.match({domRange:function(n){return{ltr:y.constant(n),rtl:x.none}},relative:function(n,t){return{ltr:bn(function(){return tl.relativeToNative(o,n,t)}),rtl:bn(function(){return x.some(tl.relativeToNative(o,t,n))})}},exact:function(n,t,e,r){return{ltr:bn(function(){return tl.exactToNative(o,n,t,e,r)}),rtl:bn(function(){return x.some(tl.exactToNative(o,e,r,n,t))})}}}));return(r=(e=i).ltr()).collapsed?e.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return el.rtl(nn.fromDom(n.endContainer),n.endOffset,nn.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return rl(0,el.ltr,r)}):rl(0,el.ltr,r)},il={ltr:el.ltr,rtl:el.rtl,diagnose:ol,asLtrRange:function(i,n){return ol(i,n).match({ltr:function(n,t,e,r){var o=i.document.createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o},rtl:function(n,t,e,r){var o=i.document.createRange();return o.setStart(e.dom(),r),o.setEnd(n.dom(),t),o}})}},ul=function(n,t,e){return t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom},al=function(n,t,e,r,o){if(0===o)return 0;if(t===r)return o-1;for(var i=r,u=1;u<o;u++){var a=n(u),c=Math.abs(t-a.left);if(e>a.bottom);else{if(e<a.top||i<c)return u-1;i=c}}return 0},cl={locate:function(l,s,f,d){var n=l.dom().createRange();n.selectNode(s.dom());var t=n.getClientRects();return ti(t,function(n){return ul(n,f,d)?x.some(n):x.none()}).map(function(n){return e=l,t=f,o=d,i=n,u=function(n){var t=e.dom().createRange();return t.setStart(r.dom(),n),t.collapse(!0),t},a=xe.get(r=s).length,c=al(function(n){return u(n).getBoundingClientRect()},t,o,i.right,a),u(c);var e,r,t,o,i,u,a,c})}},ll=function(t,n,e,r){var o=t.dom().createRange(),i=lt.children(n);return ti(i,function(n){return o.selectNode(n.dom()),ul(o.getBoundingClientRect(),e,r)?sl(t,n,e,r):x.none()})},sl=function(n,t,e,r){return(bt.isText(t)?cl.locate:ll)(n,t,e,r)},fl=function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,e)),a=Math.max(i.top,Math.min(i.bottom,r));return sl(n,t,u,a)},dl=function(n,t){return t-n.left<n.right-t},ml=function(n,t,e){var r=n.dom().createRange();return r.selectNode(t.dom()),r.collapse(e),r},gl=function(t,n,e){var r=t.dom().createRange();r.selectNode(n.dom());var o=r.getBoundingClientRect(),i=dl(o,e);return(!0===i?Ae.first:Ae.last)(n).map(function(n){return ml(t,n,i)})},hl=function(n,t,e){var r=t.dom().getBoundingClientRect(),o=dl(r,e);return x.some(ml(n,t,o))},pl=function(n,t,e){return(0===lt.children(t).length?hl:gl)(n,t,e)},vl=document.caretPositionFromPoint?function(e,n,t){return x.from(e.dom().caretPositionFromPoint(n,t)).bind(function(n){if(null===n.offsetNode)return x.none();var t=e.dom().createRange();return t.setStart(n.offsetNode,n.offset),t.collapse(),x.some(t)})}:document.caretRangeFromPoint?function(n,t,e){return x.from(n.dom().caretRangeFromPoint(t,e))}:function(e,r,o){return nn.fromPoint(e,r,o).bind(function(n){var t=function(){return pl(e,n,r)};return 0===lt.children(n).length?t():function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,e)),a=Math.max(i.top,Math.min(i.bottom,r));return fl(n,t,u,a)}(e,n,r,o).orThunk(t)})},bl=function(n,t,e){var r=nn.fromDom(n.document);return vl(r,t,e).map(function(n){return Kc.range(nn.fromDom(n.startContainer),n.startOffset,nn.fromDom(n.endContainer),n.endOffset)})},wl=function(n,t){var e=bt.name(n);return"input"===e?Gc.after(n):B.contains(["br","img"],e)?0===t?Gc.before(n):Gc.after(n):Gc.on(n,t)},yl=function(n,t){var e=n.fold(Gc.before,wl,Gc.after),r=t.fold(Gc.before,wl,Gc.after);return Kc.relative(e,r)},xl=function(n,t,e,r){var o=wl(n,t),i=wl(e,r);return Kc.relative(o,i)},Cl=function(n){return n.match({domRange:function(n){var t=nn.fromDom(n.startContainer),e=nn.fromDom(n.endContainer);return xl(t,n.startOffset,e,n.endOffset)},relative:yl,exact:xl})},Sl=yl,Rl=xl,Tl=function(n,t){x.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(t)})},Dl=function(n,t,e,r,o){var i=tl.exactToNative(n,t,e,r,o);Tl(n,i)},Al=function(i,n){return il.diagnose(i,n).match({ltr:function(n,t,e,r){Dl(i,n,t,e,r)},rtl:function(n,t,e,r){var o=i.getSelection();o.setBaseAndExtent?o.setBaseAndExtent(n.dom(),t,e.dom(),r):o.extend?(o.collapse(n.dom(),t),o.extend(e.dom(),r)):Dl(i,e,r,n,t)}})},kl=function(n){var t=nn.fromDom(n.anchorNode),e=nn.fromDom(n.focusNode);return Jc(t,n.anchorOffset,e,n.focusOffset)?x.some(Kc.range(nn.fromDom(n.anchorNode),n.anchorOffset,nn.fromDom(n.focusNode),n.focusOffset)):function(n){if(0<n.rangeCount){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return x.some(Kc.range(nn.fromDom(t.startContainer),t.startOffset,nn.fromDom(e.endContainer),e.endOffset))}return x.none()}(n)},Ol=function(n){return x.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(kl)},Nl=function(n,t,e,r,o){var i=Rl(t,e,r,o);Al(n,i)},El=function(n){return Ol(n).map(function(n){return Kc.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Bl=function(n,t,e){var r=Sl(t,e);Al(n,r)},Pl=function(n){var o=Kc.getWin(n).dom(),t=function(n,t,e,r){return tl.exactToNative(o,n,t,e,r)},e=Cl(n);return il.diagnose(o,e).match({ltr:t,rtl:t})},Il=function(n,t){var e=tl.selectNodeContents(n,t);Tl(n,e)},Wl=function(n){n.getSelection().removeAllRanges()},Ml=function(n,t){var e=il.asLtrRange(n,t);return tl.getFirstRect(e)},Ll=function(n,t,e){return bl(n,t,e)},ql=tinymce.util.Tools.resolve("tinymce.util.VK"),jl=function(n,t,e,r){return Fl(n,t,Hc(e),r)},_l=function(n,t,e,r){return Fl(n,t,Uc(e),r)},zl=function(n,t){var e=Kc.exact(t,0,t,0);return Pl(e)},Fl=function(o,n,t,i,e){return t.fold(x.none,x.none,function(n,t){return Ae.first(t).map(function(n){return zl(0,n)})},function(r){return Xt.table(r,n).bind(function(n){var t,e=jr.noMenu(r);return o.undoManager.transact(function(){i.insertRowsAfter(n,e)}),t=Ot.descendants(n,"tr"),B.last(t).bind(function(n){return zt.descendant(n,"td,th").map(function(n){return zl(0,n)})})})})},Hl=["table","li","dl"],Ul=function(t,e,r,o){if(t.keyCode===ql.TAB){var i=sa(e),u=function(n){var t=bt.name(n);return tt.eq(n,i)||B.contains(Hl,t)},n=e.selection.getRng();if(n.collapsed){var a=nn.fromDom(n.startContainer);Xt.cell(a,u).each(function(n){t.preventDefault(),(t.shiftKey?_l:jl)(e,u,n,r,o).each(function(n){e.selection.setRng(n)})})}}},Vl={response:V.immutable("selection","kill")},Gl=function(t){return function(n){return n===t}},Xl=Gl(38),Yl=Gl(40),Kl={ltr:{isBackward:Gl(37),isForward:Gl(39)},rtl:{isBackward:Gl(39),isForward:Gl(37)},isUp:Xl,isDown:Yl,isNavigation:function(n){return 37<=n&&n<=40}},$l=function(n,t){var e=il.asLtrRange(n,t);return{start:y.constant(nn.fromDom(e.startContainer)),soffset:y.constant(e.startOffset),finish:y.constant(nn.fromDom(e.endContainer)),foffset:y.constant(e.endOffset)}},Jl=function(n,t,e,r){return{start:y.constant(Gc.on(n,t)),finish:y.constant(Gc.on(e,r))}},Ql=(Qn.detect().browser.isSafari(),function(n){var t=void 0!==n?n.dom():document,e=t.body.scrollLeft||t.documentElement.scrollLeft,r=t.body.scrollTop||t.documentElement.scrollTop;return so(e,r)}),Zl=Ql,ns=function(n,t,e){(void 0!==e?e.dom():document).defaultView.scrollBy(n,t)};function ts(i){return{elementFromPoint:function(n,t){return nn.fromPoint(nn.fromDom(i.document),n,t)},getRect:function(n){return n.dom().getBoundingClientRect()},getRangedRect:function(n,t,e,r){var o=Kc.exact(n,t,e,r);return Ml(i,o).map(function(n){return q.map(n,y.apply)})},getSelection:function(){return El(i).map(function(n){return $l(i,n)})},fromSitus:function(n){var t=Kc.relative(n.start(),n.finish());return $l(i,t)},situsFromPoint:function(n,t){return Ll(i,n,t).map(function(n){return{start:y.constant(Gc.on(n.start(),n.soffset())),finish:y.constant(Gc.on(n.finish(),n.foffset()))}})},clearSelection:function(){Wl(i)},setSelection:function(n){Nl(i,n.start(),n.soffset(),n.finish(),n.foffset())},setRelativeSelection:function(n,t){Bl(i,n,t)},selectContents:function(n){Il(i,n)},getInnerHeight:function(){return i.innerHeight},getScrollY:function(){return Zl(nn.fromDom(i.document)).top()},scrollBy:function(n,t){ns(n,t,nn.fromDom(i.document))}}}var es=function(e,n,r,t,o){return tt.eq(r,t)?x.none():yr(r,t,n).bind(function(n){var t=n.boxes().getOr([]);return 0<t.length?(o(e,t,n.start(),n.finish()),x.some(Vl.response(x.some(Jl(r,0,r,Re(r))),!0))):x.none()})},rs={sync:function(e,r,n,t,o,i,u){return tt.eq(n,o)&&t===i?x.none():zt.closest(n,"td,th",r).bind(function(t){return zt.closest(o,"td,th",r).bind(function(n){return es(e,r,t,n,u)})})},detect:es,update:function(n,t,e,r,o){return Cr(r,n,t,o.firstSelectedSelector(),o.lastSelectedSelector()).map(function(n){return o.clear(e),o.selectRange(e,n.boxes(),n.start(),n.finish()),n.boxes()})}},os=V.immutableBag(["left","top","right","bottom"],[]),is={nu:os,moveUp:function(n,t){return os({left:n.left(),top:n.top()-t,right:n.right(),bottom:n.bottom()-t})},moveDown:function(n,t){return os({left:n.left(),top:n.top()+t,right:n.right(),bottom:n.bottom()+t})},moveBottomTo:function(n,t){var e=n.bottom()-n.top();return os({left:n.left(),top:t-e,right:n.right(),bottom:t})},moveTopTo:function(n,t){var e=n.bottom()-n.top();return os({left:n.left(),top:t,right:n.right(),bottom:t+e})},getTop:function(n){return n.top()},getBottom:function(n){return n.bottom()},translate:function(n,t,e){return os({left:n.left()+t,top:n.top()+e,right:n.right()+t,bottom:n.bottom()+e})},toString:function(n){return"("+n.left()+", "+n.top()+") -> ("+n.right()+", "+n.bottom()+")"}},us=function(n){return is.nu({left:n.left,top:n.top,right:n.right,bottom:n.bottom})},as=function(n,t){return x.some(n.getRect(t))},cs=function(n,t,e){return bt.isElement(t)?as(n,t).map(us):bt.isText(t)?(r=n,o=t,i=e,0<=i&&i<Re(o)?r.getRangedRect(o,i,o,i+1):0<i?r.getRangedRect(o,i-1,o,i):x.none()).map(us):x.none();var r,o,i},ls=function(n,t){return bt.isElement(t)?as(n,t).map(us):bt.isText(t)?n.getRangedRect(t,0,t,Re(t)).map(us):x.none()},ss=V.immutable("item","mode"),fs=function(n,t,e,r){var o=void 0!==r?r:ds;return n.property().parent(t).map(function(n){return ss(n,o)})},ds=function(n,t,e,r){var o=void 0!==r?r:ms;return e.sibling(n,t).map(function(n){return ss(n,o)})},ms=function(n,t,e,r){var o=void 0!==r?r:ms,i=n.property().children(t);return e.first(i).map(function(n){return ss(n,o)})},gs=[{current:fs,next:ds,fallback:x.none()},{current:ds,next:ms,fallback:x.some(fs)},{current:ms,next:ms,fallback:x.some(ds)}],hs=function(t,e,r,o,n){return n=void 0!==n?n:gs,B.find(n,function(n){return n.current===r}).bind(function(n){return n.current(t,e,o,n.next).orThunk(function(){return n.fallback.bind(function(n){return hs(t,e,n,o)})})})},ps={backtrack:fs,sidestep:ds,advance:ms,go:hs},vs={left:function(){return{sibling:function(n,t){return n.query().prevSibling(t)},first:function(n){return 0<n.length?x.some(n[n.length-1]):x.none()}}},right:function(){return{sibling:function(n,t){return n.query().nextSibling(t)},first:function(n){return 0<n.length?x.some(n[0]):x.none()}}}},bs=function(t,n,e,r,o,i){return ps.go(t,n,r,o).bind(function(n){return i(n.item())?x.none():e(n.item())?x.some(n.item()):bs(t,n.item(),e,n.mode(),o,i)})},ws=function(n,t,e,r){return bs(n,t,e,ps.sidestep,vs.left(),r)},ys=function(n,t,e,r){return bs(n,t,e,ps.sidestep,vs.right(),r)},xs=function(n,t){return 0===n.property().children(t).length},Cs=function(n,t,e,r){return ws(n,t,e,r)},Ss=function(n,t,e,r){return ys(n,t,e,r)},Rs={before:function(n,t,e){return Cs(n,t,y.curry(xs,n),e)},after:function(n,t,e){return Ss(n,t,y.curry(xs,n),e)},seekLeft:Cs,seekRight:Ss,walkers:function(){return{left:vs.left,right:vs.right}},walk:function(n,t,e,r,o){return ps.go(n,t,e,r,o)},backtrack:ps.backtrack,sidestep:ps.sidestep,advance:ps.advance},Ts=Me(),Ds={gather:function(n,t,e){return Rs.gather(Ts,n,t,e)},before:function(n,t){return Rs.before(Ts,n,t)},after:function(n,t){return Rs.after(Ts,n,t)},seekLeft:function(n,t,e){return Rs.seekLeft(Ts,n,t,e)},seekRight:function(n,t,e){return Rs.seekRight(Ts,n,t,e)},walkers:function(){return Rs.walkers()},walk:function(n,t,e,r){return Rs.walk(Ts,n,t,e,r)}},As=Nr([{none:[]},{retry:["caret"]}]),ks=function(t,n,r){return jt.closest(n,Go).fold(y.constant(!1),function(n){return ls(t,n).exists(function(n){return e=n,(t=r).left()<e.left()||Math.abs(e.right()-t.left())<1||t.left()>e.right();var t,e})})},Os={point:is.getTop,adjuster:function(n,t,e,r,o){var i=is.moveUp(o,5);return Math.abs(e.top()-r.top())<1?As.retry(i):e.bottom()<o.top()?As.retry(i):e.bottom()===o.top()?As.retry(is.moveUp(o,1)):ks(n,t,o)?As.retry(is.translate(i,5,0)):As.none()},move:is.moveUp,gather:Ds.before},Ns={point:is.getBottom,adjuster:function(n,t,e,r,o){var i=is.moveDown(o,5);return Math.abs(e.bottom()-r.bottom())<1?As.retry(i):e.top()>o.bottom()?As.retry(i):e.top()===o.bottom()?As.retry(is.moveDown(o,1)):ks(n,t,o)?As.retry(is.translate(i,5,0)):As.none()},move:is.moveDown,gather:Ds.after},Es=function(e,r,o,i,u){return 0===u?x.some(i):(c=e,l=i.left(),s=r.point(i),c.elementFromPoint(l,s).filter(function(n){return"table"===bt.name(n)}).isSome()?(t=i,a=u-1,Es(e,n=r,o,n.move(t,5),a)):e.situsFromPoint(i.left(),r.point(i)).bind(function(n){return n.start().fold(x.none,function(t,n){return ls(e,t,n).bind(function(n){return r.adjuster(e,t,n,o,i).fold(x.none,function(n){return Es(e,r,o,n,u-1)})}).orThunk(function(){return x.some(i)})},x.none)}));var n,t,a,c,l,s},Bs=function(t,e,n){var r,o,i,u=t.move(n,5),a=Es(e,t,n,u,100).getOr(u);return(r=t,o=a,i=e,r.point(o)>i.getInnerHeight()?x.some(r.point(o)-i.getInnerHeight()):r.point(o)<0?x.some(-r.point(o)):x.none()).fold(function(){return e.situsFromPoint(a.left(),t.point(a))},function(n){return e.scrollBy(0,n),e.situsFromPoint(a.left(),t.point(a)-n)})},Ps={tryUp:y.curry(Bs,Os),tryDown:y.curry(Bs,Ns),ieTryUp:function(n,t){return n.situsFromPoint(t.left(),t.top()-5)},ieTryDown:function(n,t){return n.situsFromPoint(t.left(),t.bottom()+5)},getJumpSize:y.constant(5)},Is=Nr([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Ws=function(n){return zt.closest(n,"tr")},Ms={verify:function(a,n,t,e,r,c,o){return zt.closest(e,"td,th",o).bind(function(u){return zt.closest(n,"td,th",o).map(function(i){return tt.eq(u,i)?tt.eq(e,u)&&Re(u)===r?c(i):Is.none("in same cell"):er.sharedOne(Ws,[u,i]).fold(function(){return t=i,e=u,r=(n=a).getRect(t),(o=n.getRect(e)).right>r.left&&o.left<r.right?Is.success():c(i);var n,t,e,r,o},function(n){return c(i)})})}).getOr(Is.none("default"))},cata:function(n,t,e,r,o){return n.fold(t,e,r,o)},adt:Is},Ls={point:V.immutable("element","offset"),delta:V.immutable("element","deltaOffset"),range:V.immutable("element","start","finish"),points:V.immutable("begin","end"),text:V.immutable("element","text")},qs=(V.immutable("ancestor","descendants","element","index"),V.immutable("parent","children","element","index")),js=function(n,t){return B.findIndex(n,y.curry(tt.eq,t))},_s=function(r){return lt.parent(r).bind(function(t){var e=lt.children(t);return js(e,r).map(function(n){return qs(t,e,r,n)})})},zs=function(n){return"br"===bt.name(n)},Fs=function(n,t,e){return t(n,e).bind(function(n){return bt.isText(n)&&0===xe.get(n).trim().length?Fs(n,t,e):x.some(n)})},Hs=function(t,n,e,r){return(o=n,i=e,lt.child(o,i).filter(zs).orThunk(function(){return lt.child(o,i-1).filter(zs)})).bind(function(n){return r.traverse(n).fold(function(){return Fs(n,r.gather,t).map(r.relative)},function(n){return _s(n).map(function(n){return Gc.on(n.parent(),n.index())})})});var o,i},Us=function(n,t,e,r){var o,i,u;return(zs(t)?(o=n,i=t,(u=r).traverse(i).orThunk(function(){return Fs(i,u.gather,o)}).map(u.relative)):Hs(n,t,e,r)).map(function(n){return{start:y.constant(n),finish:y.constant(n)}})},Vs=function(n){return Ms.cata(n,function(n){return x.none()},function(){return x.none()},function(n){return x.some(Ls.point(n,0))},function(n){return x.some(Ls.point(n,Re(n)))})},Gs=Qn.detect(),Xs=function(r,o,i,u,a,c){return 0===c?x.none():$s(r,o,i,u,a).bind(function(n){var t=r.fromSitus(n),e=Ms.verify(r,i,u,t.finish(),t.foffset(),a.failure,o);return Ms.cata(e,function(){return x.none()},function(){return x.some(n)},function(n){return tt.eq(i,n)&&0===u?Ys(r,i,u,is.moveUp,a):Xs(r,o,n,0,a,c-1)},function(n){return tt.eq(i,n)&&u===Re(n)?Ys(r,i,u,is.moveDown,a):Xs(r,o,n,Re(n),a,c-1)})})},Ys=function(t,n,e,r,o){return cs(t,n,e).bind(function(n){return Ks(t,o,r(n,Ps.getJumpSize()))})},Ks=function(n,t,e){return Gs.browser.isChrome()||Gs.browser.isSafari()||Gs.browser.isFirefox()||Gs.browser.isEdge()?t.otherRetry(n,e):Gs.browser.isIE()?t.ieRetry(n,e):x.none()},$s=function(t,n,e,r,o){return cs(t,e,r).bind(function(n){return Ks(t,o,n)})},Js=function(t,e,r){return(o=t,i=e,u=r,o.getSelection().bind(function(r){return Us(i,r.finish(),r.foffset(),u).fold(function(){return x.some(Ls.point(r.finish(),r.foffset()))},function(n){var t=o.fromSitus(n),e=Ms.verify(o,r.finish(),r.foffset(),t.finish(),t.foffset(),u.failure,i);return Vs(e)})})).bind(function(n){return Xs(t,e,n.element(),n.offset(),r,20).map(t.fromSitus)});var o,i,u},Qs=function(n,t,e){return jt.ancestor(n,t,e).isSome()},Zs=Qn.detect(),nf=function(r,o,i,n,u){return zt.closest(n,"td,th",o).bind(function(e){return zt.closest(e,"table",o).bind(function(n){return t=n,Qs(u,function(n){return lt.parent(n).exists(function(n){return tt.eq(n,t)})})?Js(r,o,i).bind(function(t){return zt.closest(t.finish(),"td,th",o).map(function(n){return{start:y.constant(e),finish:y.constant(n),range:y.constant(t)}})}):x.none();var t})})},tf=function(n,t,e,r,o,i){return Zs.browser.isIE()?x.none():i(r,t).orThunk(function(){return nf(n,t,e,r,o).map(function(n){var t=n.range();return Vl.response(x.some(Jl(t.start(),t.soffset(),t.finish(),t.foffset())),!0)})})},ef=function(n,t,e,r,o,i,u){return nf(n,e,r,o,i).bind(function(n){return rs.detect(t,e,n.start(),n.finish(),u)})},rf=function(n,r){return zt.closest(n,"tr",r).bind(function(e){return zt.closest(e,"table",r).bind(function(n){var t=Ot.descendants(n,"tr");return tt.eq(e,t[0])?Ds.seekLeft(n,function(n){return Ae.last(n).isSome()},r).map(function(n){var t=Re(n);return Vl.response(x.some(Jl(n,t,n,t)),!0)}):x.none()})})},of=function(n,r){return zt.closest(n,"tr",r).bind(function(e){return zt.closest(e,"table",r).bind(function(n){var t=Ot.descendants(n,"tr");return tt.eq(e,t[t.length-1])?Ds.seekRight(n,function(n){return Ae.first(n).isSome()},r).map(function(n){return Vl.response(x.some(Jl(n,0,n,0)),!0)}):x.none()})})},uf=function(n,t){return zt.closest(n,"td,th",t)},af={down:{traverse:lt.nextSibling,gather:Ds.after,relative:Gc.before,otherRetry:Ps.tryDown,ieRetry:Ps.ieTryDown,failure:Ms.adt.failedDown},up:{traverse:lt.prevSibling,gather:Ds.before,relative:Gc.before,otherRetry:Ps.tryUp,ieRetry:Ps.ieTryUp,failure:Ms.adt.failedUp}},cf=V.immutable("rows","cols"),lf={mouse:function(n,t,e,r){var o,i,u,a,c,l,s=ts(n),f=(o=s,i=t,u=e,a=r,c=x.none(),l=function(){c=x.none()},{mousedown:function(n){a.clear(i),c=uf(n.target(),u)},mouseover:function(n){c.each(function(r){a.clear(i),uf(n.target(),u).each(function(e){yr(r,e,u).each(function(n){var t=n.boxes().getOr([]);(1<t.length||1===t.length&&!tt.eq(r,e))&&(a.selectRange(i,t,n.start(),n.finish()),o.selectContents(e))})})})},mouseup:function(){c.each(l)}});return{mousedown:f.mousedown,mouseover:f.mouseover,mouseup:f.mouseup}},keyboard:function(n,c,l,s){var f=ts(n),d=function(){return s.clear(c),x.none()};return{keydown:function(n,t,e,r,o,i){var u=n.raw().which,a=!0===n.raw().shiftKey;return xr(c,s.selectedSelector()).fold(function(){return Kl.isDown(u)&&a?y.curry(ef,f,c,l,af.down,r,t,s.selectRange):Kl.isUp(u)&&a?y.curry(ef,f,c,l,af.up,r,t,s.selectRange):Kl.isDown(u)?y.curry(tf,f,l,af.down,r,t,of):Kl.isUp(u)?y.curry(tf,f,l,af.up,r,t,rf):x.none},function(t){var n=function(n){return function(){return ti(n,function(n){return rs.update(n.rows(),n.cols(),c,t,s)}).fold(function(){return Sr(c,s.firstSelectedSelector(),s.lastSelectedSelector()).map(function(n){var t=Kl.isDown(u)||i.isForward(u)?Gc.after:Gc.before;return f.setRelativeSelection(Gc.on(n.first(),0),t(n.table())),s.clear(c),Vl.response(x.none(),!0)})},function(n){return x.some(Vl.response(x.none(),!0))})}};return Kl.isDown(u)&&a?n([cf(1,0)]):Kl.isUp(u)&&a?n([cf(-1,0)]):i.isBackward(u)&&a?n([cf(0,-1),cf(-1,0)]):i.isForward(u)&&a?n([cf(0,1),cf(1,0)]):Kl.isNavigation(u)&&!1===a?d:x.none})()},keyup:function(t,e,r,o,i){return xr(c,s.selectedSelector()).fold(function(){var n=t.raw().which;return 0==(!0===t.raw().shiftKey)?x.none():Kl.isNavigation(n)?rs.sync(c,l,e,r,o,i,s.selectRange):x.none()},x.none)}}}},sf=function(t,n){B.each(n,function(n){Wi.remove(t,n)})},ff=function(t){return function(n){Wi.add(n,t)}},df=function(t){return function(n){sf(n,t)}},mf={byClass:function(o){var i=ff(o.selected()),e=df([o.selected(),o.lastSelected(),o.firstSelected()]),u=function(n){var t=Ot.descendants(n,o.selectedSelector());B.each(t,e)};return{clear:u,selectRange:function(n,t,e,r){u(n),B.each(t,i),Wi.add(e,o.firstSelected()),Wi.add(r,o.lastSelected())},selectedSelector:o.selectedSelector,firstSelectedSelector:o.firstSelectedSelector,lastSelectedSelector:o.lastSelectedSelector}},byAttr:function(o){var e=function(n){St.remove(n,o.selected()),St.remove(n,o.firstSelected()),St.remove(n,o.lastSelected())},i=function(n){St.set(n,o.selected(),"1")},u=function(n){var t=Ot.descendants(n,o.selectedSelector());B.each(t,e)};return{clear:u,selectRange:function(n,t,e,r){u(n),B.each(t,i),St.set(e,o.firstSelected(),"1"),St.set(r,o.lastSelected(),"1")},selectedSelector:o.selectedSelector,firstSelectedSelector:o.firstSelectedSelector,lastSelectedSelector:o.lastSelectedSelector}}},gf=function(n){return!1===Wi.has(nn.fromDom(n.target),"ephox-snooker-resizer-bar")},hf=qa.each,pf=function(t){var e=[];function n(n){return function(){t.execCommand(n)}}hf("inserttable tableprops deletetable".split(" "),function(n){"|"===n?e.push({text:"-"}):e.push(t.menuItems[n])}),t.addButton("table",{type:"menubutton",title:"Table",menu:e}),t.addButton("tableprops",{title:"Table properties",onclick:n("mceTableProps"),icon:"table"}),t.addButton("tabledelete",{title:"Delete table",onclick:n("mceTableDelete")}),t.addButton("tablecellprops",{title:"Cell properties",onclick:n("mceTableCellProps")}),t.addButton("tablemergecells",{title:"Merge cells",onclick:n("mceTableMergeCells")}),t.addButton("tablesplitcells",{title:"Split cell",onclick:n("mceTableSplitCells")}),t.addButton("tableinsertrowbefore",{title:"Insert row before",onclick:n("mceTableInsertRowBefore")}),t.addButton("tableinsertrowafter",{title:"Insert row after",onclick:n("mceTableInsertRowAfter")}),t.addButton("tabledeleterow",{title:"Delete row",onclick:n("mceTableDeleteRow")}),t.addButton("tablerowprops",{title:"Row properties",onclick:n("mceTableRowProps")}),t.addButton("tablecutrow",{title:"Cut row",onclick:n("mceTableCutRow")}),t.addButton("tablecopyrow",{title:"Copy row",onclick:n("mceTableCopyRow")}),t.addButton("tablepasterowbefore",{title:"Paste row before",onclick:n("mceTablePasteRowBefore")}),t.addButton("tablepasterowafter",{title:"Paste row after",onclick:n("mceTablePasteRowAfter")}),t.addButton("tableinsertcolbefore",{title:"Insert column before",onclick:n("mceTableInsertColBefore")}),t.addButton("tableinsertcolafter",{title:"Insert column after",onclick:n("mceTableInsertColAfter")}),t.addButton("tabledeletecol",{title:"Delete column",onclick:n("mceTableDeleteCol")})},vf=function(t){var n,e=""===(n=t.getParam("table_toolbar",xa))||!1===n?[]:p.isString(n)?n.split(/[ ,]/):p.isArray(n)?n:[];0<e.length&&t.addContextToolbar(function(n){return t.dom.is(n,"table")&&t.getBody().contains(n)},e.join(" "))},bf=function(o,e){var r=x.none(),i=[],u=[],a=[],c=[],l=function(n){n.disabled(!0)},s=function(n){n.disabled(!1)},n=function(){var t=this;i.push(t),r.fold(function(){l(t)},function(n){s(t)})};o.on("init",function(){o.on("nodechange",function(n){var t=x.from(o.dom.getParent(o.selection.getStart(),"th,td"));(r=t.bind(function(n){var t=nn.fromDom(n);return Xt.table(t).map(function(n){return jr.forMenu(e,n,t)})})).fold(function(){B.each(i,l),B.each(u,l),B.each(a,l),B.each(c,l)},function(t){B.each(i,s),B.each(u,s),B.each(a,function(n){n.disabled(t.mergable().isNone())}),B.each(c,function(n){n.disabled(t.unmergable().isNone())})})})});var f=function(n,t,e,r){var o,i,u,a,c,l=r.getEl().getElementsByTagName("table")[0],s=r.isRtl()||"tl-tr"===r.parent().rel;for(l.nextSibling.innerHTML=t+1+" x "+(e+1),s&&(t=9-t),i=0;i<10;i++)for(o=0;o<10;o++)a=l.rows[i].childNodes[o].firstChild,c=(s?t<=o:o<=t)&&i<=e,n.dom.toggleClass(a,"mce-active",c),c&&(u=a);return u.parentNode},t=!1===o.getParam("table_grid",!0,"boolean")?{text:"Table",icon:"table",context:"table",onclick:d("mceInsertTable")}:{text:"Table",icon:"table",context:"table",ariaHideMenu:!0,onclick:function(n){n.aria&&(this.parent().hideAll(),n.stopImmediatePropagation(),o.execCommand("mceInsertTable"))},onshow:function(){f(o,0,0,this.menu.items()[0])},onhide:function(){var n=this.menu.items()[0].getEl().getElementsByTagName("a");o.dom.removeClass(n,"mce-active"),o.dom.addClass(n[0],"mce-active")},menu:[{type:"container",html:function(){var n="";n='<table role="grid" class="mce-grid mce-grid-border" aria-readonly="true">';for(var t=0;t<10;t++){n+="<tr>";for(var e=0;e<10;e++)n+='<td role="gridcell" tabindex="-1"><a id="mcegrid'+(10*t+e)+'" href="#" data-mce-x="'+e+'" data-mce-y="'+t+'"></a></td>';n+="</tr>"}return n+="</table>",n+='<div class="mce-text-center" role="presentation">1 x 1</div>'}(),onPostRender:function(){this.lastX=this.lastY=0},onmousemove:function(n){var t,e,r=n.target;"A"===r.tagName.toUpperCase()&&(t=parseInt(r.getAttribute("data-mce-x"),10),e=parseInt(r.getAttribute("data-mce-y"),10),(this.isRtl()||"tl-tr"===this.parent().rel)&&(t=9-t),t===this.lastX&&e===this.lastY||(f(o,t,e,n.control),this.lastX=t,this.lastY=e))},onclick:function(n){var t=this;"A"===n.target.tagName.toUpperCase()&&(n.preventDefault(),n.stopPropagation(),t.parent().cancel(),o.undoManager.transact(function(){ic(o,t.lastX+1,t.lastY+1)}),o.addVisual())}}]};function d(n){return function(){o.execCommand(n)}}var m={text:"Table properties",context:"table",onPostRender:n,onclick:d("mceTableProps")},g={text:"Delete table",context:"table",onPostRender:n,cmd:"mceTableDelete"};o.addMenuItem("inserttable",t),o.addMenuItem("tableprops",m),o.addMenuItem("deletetable",g)},wf=function(e,o){return{insertTable:function(n,t){return ic(e,n,t)},setClipboardRows:function(n){return t=n,e=o,r=B.map(t,nn.fromDom),void e.set(x.from(r));var t,e,r},getClipboardRows:function(){return o.get().fold(function(){},function(n){return B.map(n,function(n){return n.dom()})})}}};u.add("tablecustom",function(t){var h,p,v,b,w,e,r=Mc(t),n=(h=t,p=r.lazyResize,v=V.immutableBag(["mousedown","mouseover","mouseup","keyup","keydown"],[]),b=x.none(),w=mf.byAttr(Or),h.on("init",function(n){var r=h.getWin(),o=sa(h),t=ma(h),e=lf.mouse(r,o,t,w),a=lf.keyboard(r,o,t,w),c=function(n,t){!0===n.raw().shiftKey&&(t.kill()&&n.kill(),t.selection().each(function(n){var t=Kc.relative(n.start(),n.finish()),e=il.asLtrRange(r,t);h.selection.setRng(e)}))},i=function(n){var t=s(n);if(t.raw().shiftKey&&Kl.isNavigation(t.raw().which)){var e=h.selection.getRng(),r=nn.fromDom(e.startContainer),o=nn.fromDom(e.endContainer);a.keyup(t,r,e.startOffset,o,e.endOffset).each(function(n){c(t,n)})}},u=function(n){var t=s(n);p().each(function(n){n.hideBars()});var e=h.selection.getRng(),r=nn.fromDom(h.selection.getStart()),o=nn.fromDom(e.startContainer),i=nn.fromDom(e.endContainer),u=ya.directionAt(r).isRtl()?Kl.rtl:Kl.ltr;a.keydown(t,o,e.startOffset,i,e.endOffset,u).each(function(n){c(t,n)}),p().each(function(n){n.showBars()})},l=function(n){return n.hasOwnProperty("x")&&n.hasOwnProperty("y")},s=function(n){var t=nn.fromDom(n.target),e=function(){n.stopPropagation()},r=function(){n.preventDefault()},o=y.compose(r,e);return{target:y.constant(t),x:y.constant(l(n)?n.x:null),y:y.constant(l(n)?n.y:null),stop:e,prevent:r,kill:o,raw:y.constant(n)}},f=function(n){return 0===n.button},d=function(n){f(n)&&gf(n)&&e.mousedown(s(n))},m=function(n){var t;void 0!==(t=n).buttons&&0==(1&t.buttons)||!gf(n)||e.mouseover(s(n))},g=function(n){f(n)&&gf(n)&&e.mouseup(s(n))};h.on("mousedown",d),h.on("mouseover",m),h.on("mouseup",g),h.on("keyup",i),h.on("keydown",u),h.on("nodechange",function(){var n=h.selection,t=nn.fromDom(n.getStart()),e=nn.fromDom(n.getEnd());er.sharedOne(Xt.table,[t,e]).fold(function(){w.clear(o)},y.noop)}),b=x.some(v({mousedown:d,mouseover:m,mouseup:g,keyup:i,keydown:u}))}),{clear:w.clear,destroy:function(){b.each(function(n){})}}),o=Ma(t,r.lazyWire),i=(e=t,{get:function(){var n=sa(e);return Rr(n,Or.selectedSelector()).fold(function(){return void 0===e.selection.getStart()?Br.none():Br.single(e.selection)},function(n){return Br.multiple(n)})}}),u=Oo(x.none());return sc(t,o,n,i,u),_r(t,i,o,n),bf(t,i),pf(t),vf(t),t.on("PreInit",function(){t.serializer.addTempAttr(Or.firstSelected()),t.serializer.addTempAttr(Or.lastSelected())}),t.getParam("table_tab_navigation",!0,"boolean")&&t.on("keydown",function(n){Ul(n,t,o,r.lazyWire)}),t.on("remove",function(){r.destroy(),n.destroy()}),wf(t,u)})}();